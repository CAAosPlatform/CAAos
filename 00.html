

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Introduction &mdash; CAAos Platform 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/style.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> CAAos Platform
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">File formats</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="fileFormats.html">File Formats</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CAAos Platform</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><strong>Introduction</strong></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/00.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="introduction">
<h1><strong>Introduction</strong><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<ol class="arabic">
<li><p class="rubric" id="introducing-the-platform"><strong>Introducing the platform.</strong></p>
<ol class="arabic">
<li><p class="rubric" id="the-platform"><strong>The platform</strong></p>
</li>
</ol>
</li>
</ol>
<p>The CAAos platform was developed in Python 3 language, aiming for a
concise, easy to use experience. It is available under GNU GPLv3 license
at
<a class="reference external" href="https://github.com/CAAosPlatform/CAAos">*https://github.com/CAAosPlatform/CAAos*</a>.
The installation package and instructions are also available, together
with a demo data of two subjects (one healthy control and one stroke
patient data), allowing users to operate the platform and its
functionalities. Figure 1 presents the home screen of the platform once
it is launched. <a class="reference internal" href="media/image14.png"><img alt="image1" src="media/image14.png" style="width: 5.67717in; height: 3.31102in;" /></a></p>
<p>Figure 1: Platform’s home screen.</p>
<div class="section" id="menu-entries">
<h2><strong>Menu Entries</strong><a class="headerlink" href="#menu-entries" title="Permalink to this headline">¶</a></h2>
<p>There are three main menu entries in the toolbar inside the home screen
(see Figure 1), being them:</p>
<ol class="arabic">
<li><p><em>File:</em> This tab enables the user to exit the platform;</p></li>
<li><dl class="simple">
<dt><em>Toolboxes:</em> This menu entry allows the user to initiate the</dt><dd><p>patient’s autoregulation analysis by first performing the
preprocessing steps, as described in 2.2, and then the cerebral
autoregulation analysis;</p>
</dd>
</dl>
</li>
<li><dl>
<dt><em>Help:</em> This menu entry contains information about the platform,</dt><dd><blockquote>
<div><p>version, licenses, credits and authors. <a class="reference internal" href="media/image20.jpg"><img alt="image2" src="media/image20.jpg" style="width: 6.61667in; height: 3.61389in;" /></a></p>
</div></blockquote>
<p>Figure 2: Indication of the main tabs of the platform.</p>
</dd>
</dl>
</li>
</ol>
</div>
</div>
<div class="section" id="using-caaos-platform">
<h1><strong>Using CAAos platform</strong><a class="headerlink" href="#using-caaos-platform" title="Permalink to this headline">¶</a></h1>
<div class="section" id="collecting-the-data">
<h2><strong>2.1 Collecting the Data</strong><a class="headerlink" href="#collecting-the-data" title="Permalink to this headline">¶</a></h2>
<p>Before initiating CAAos platform, the user needs to collect the
subject’s signals. The signals are the cerebral blood flow velocity
(CBFv) and arterial blood pressure (ABP). Other signals such as
end-tidal carbon dioxide (EtCO:sub:<cite>2</cite>) can also be uploaded. The first
two signals are collected as presented below.</p>
<blockquote>
<div><p><strong>2.2 Input file format</strong></p>
</div></blockquote>
<p>To import the signals to the platform, the collected data must be
written in a text file. The file must inform the sampling rate in which
the signals were collected, and the data must be written in columns,
separated with a TAB.</p>
<p>This format allows users to import not just CBFv, ABP and EtCO<sub>2</sub>
signals but other time dependent data according to the user’s needs. The
only information necessary are the Sampling rate (in Hz), column labels,
units and the numeric data. Patient name and birthday are not used.
Examination date is loaded from the file but it is not currently used
for anything.</p>
<p><em>Patient Name: XXXXX</em></p>
<p><em>birthday:DD:MM:YYYY</em></p>
<p><em>Examination:DD:M:YYYY HH:MM:SS</em></p>
<p><em>Sampling Rate: XXXHz</em></p>
<p><em>Time Sample &lt;CH_0_label&gt; &lt;CH_1_label&gt; … &lt;CH_N_label&gt;</em></p>
<p><em>HH:mm:ss:ms N &lt;CH_0_unit&gt; &lt;CH_1_unit&gt; … &lt;CH_N_unit&gt;</em></p>
<p><em>00:00:00:00 0 0 xxx1 xxx2 … xxxN</em></p>
<p><em>00:00:00:10 0 0 yyy1 yyy2 … yyyN</em></p>
</div>
<div class="section" id="preprocessing-toolbox">
<h2><strong>Preprocessing Toolbox</strong><a class="headerlink" href="#preprocessing-toolbox" title="Permalink to this headline">¶</a></h2>
<p>Signal analysis starts with the preprocessing toolbox. This toolbox is
accessible via Toolboxes menu entry, selecting ‘’Preprocessing’’.</p>
<p>The user is then requested to create a new job or load a previously
created job file (see figure 6).</p>
<p>If the user selects ‘’New Job’’ the platform will require to select the
text file containing the subject’s data. By doing this, the platform
will load and show the subject’s data (as demonstrated in Figure 7).</p>
<ul class="simple">
<li><dl class="simple">
<dt>If the user selects “Load job”, the user is asked to selecte teh job</dt><dd><p>file (.job)to open a file containing a preprocessing previously
performed.</p>
</dd>
</dl>
</li>
</ul>
<p><a class="reference internal" href="media/image7.png"><img alt="Interface gráfica do usuário, Aplicativo Descrição gerada automaticamente" src="media/image7.png" style="width: 6.30278in; height: 4.19583in;" /></a></p>
<p>Figure 6: Creating or Loading a .job file in Pre Processing toolbox.**
**</p>
<p><a class="reference internal" href="media/image22.png"><img alt="Interface gráfica do usuário, Texto Descrição gerada automaticamente com confiança média" src="media/image22.png" style="width: 6.14977in; height: 3.28358in;" /></a></p>
<p>Figure 7: Illustration of the first tab of the platform:
Labels/Types.**
**</p>
<p>At this point, the user can start the data preprocessing, which contains
the following tabs:</p>
<ul class="simple">
<li><p>Labels/types</p></li>
<li><p>Resample/Calibrate</p></li>
<li><p>Sync/Filter</p></li>
<li><p>Artefact Removal</p></li>
<li><p>RR detection</p></li>
<li><p>Beat to beat.</p></li>
</ul>
<div class="section" id="labels-types">
<h3><strong>2.2.1 Labels/Types</strong><a class="headerlink" href="#labels-types" title="Permalink to this headline">¶</a></h3>
<p>When the Preprocessing toolbox opens, it will automatically show the
Labels/Types tab, as represented in Figure 7. On the column “Labels”
(Figure 8), the user will see the provisory name of the channels read
automatically from the input data heading. In this stage, the user can
label the signals following his/her preference. It is presented below an
example of labeling the signals.</p>
<ul class="simple">
<li><dl class="simple">
<dt><strong>Channel 0:</strong> Middle Cerebral Artery of the left cerebral hemisphere</dt><dd><p>(Label: CBFv_Left)</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Channel 1:</strong> Middle Cerebral Artery of the right cerebral</dt><dd><p>hemisphere (Label: CBFv_Right)</p>
</dd>
</dl>
</li>
<li><p><strong>Channel 2:</strong> Arterial Blood Pressure (Label: ABP)</p></li>
<li><p><strong>Channel 3:</strong> End-Tidal Carbon Dioxide (Label: ETCO2)</p></li>
</ul>
<p>After labeling the signals, the user can select the signals’ unit and
then the “Signal Type”. The last columns, Signal Type, is a
preconfigured named list, to allow the CAAos platform identify the
signals to the cerebral autoregulation analysis.</p>
<p><a class="reference internal" href="media/image33.png"><img alt="Interface gráfica do usuário Descrição gerada automaticamente" src="media/image33.png" style="width: 5.24130in; height: 2.91468in;" /></a></p>
<p>Figure 8: Example of indication of the column signal type.</p>
<p>Observation: Changin the unit will not change the numeric values. This
is just a label used to show the results. For changing the unit, please
see Resample/Calibrate tab.</p>
<p>The changes will be recorded when the user click on “Apply” button. The
plots will be updated when the user click ‘Apply’ (Figure 9).</p>
<p><a class="reference internal" href="media/image27.png"><img alt="Uma imagem contendo Diagrama Descrição gerada automaticamente" src="media/image27.png" style="width: 6.17014in; height: 3.35836in;" /></a></p>
<p>Figure 9: Graphics of the labeled signals.</p>
<p>he user can zoom in/out and move the plots using the mouse.</p>
</div>
<div class="section" id="resample-calibrate">
<h3><strong>2.2.2 Resample/Calibrate</strong><a class="headerlink" href="#resample-calibrate" title="Permalink to this headline">¶</a></h3>
<p>Once the settings of Labels/Types is performed, the user can move to the
next tab “Resample/Calibrate”, as presented in the figure 10. In this
tab, the user will be able to configure the following settings:</p>
<blockquote>
<div><p><strong>1)</strong> Change the Sampling Frequency Type – the user may choose
among Minimum, Maximum or Customized sampling frequency. Since ABP
and CBFv are recorded from different equipment, the sampling
frequency can be different between them. See further details below
in the “Background” subsection”.</p>
<p><strong>2)</strong> Change the interpolation method - the available methods of
interpolation are Zero, Linear, Quadratic or Cubic. The CARNet
<sup>[3]</sup> suggests linear interpolation method.</p>
<p><strong>3)</strong> Change the sampling frequency - The CARNet <sup>[3] also</sup>
suggests a sampling frequency of 100 Hz, then the user can select
“custom” and then define the sampling frequency value.</p>
</div></blockquote>
<p>When this procedure is done, the user can click on “Resample”.</p>
<blockquote>
<div><p><strong>4)</strong> Signals’ calibration - the user may calibrate the signals
individually, in special the ABP signal (if the user also measured
ABP with another equipment simultaneously, such a sphygmomanometer,
prior the beat-to-beat ABP recording). To calibrate a chosen signal,
the user needs to set minimum and maximum parameters at “Min” and
“Max” columns. Calibration methods includes “Absolute” and “5/95
percentile” and it can be applied to a signal window or to the
entire signal data. The user must click on “Calibrate” to finalize
the procedure.</p>
</div></blockquote>
<p><a class="reference internal" href="media/image29.png"><img alt="Tabela Descrição gerada automaticamente" src="media/image29.png" style="width: 6.63611in; height: 3.46875in;" /></a>Figure 10: Illustration of
the tab Resample/Calibrate with indication of the tools.</p>
<p><strong>*Background*</strong></p>
<p><em>Frequency Type</em>: The CBFv and ABP signals have the sampling frequency
according to the equipment in which they are collected. In our tests,
the sampling frequency of Doppler-box (data acquisition equipment) was
100 Hz, however this maybe not be same for other research centers.
Thereby, the user can adjust the CBFv and ABP signals to both have the
same sampling frequency. To do that, on “Frequency Type”, the user can
choose the minimum option to perform downsampling, i.e., the signals
will be sampled with the sampling frequency defined by the signal with
the lowest one. On the other hand, if the user chooses the maximum
option, the platform will perform an upsampling, i.e., the signals will
have the same sampling frequency value as the signal sampled fastest.
Lastly, the user can choose to use the customized option to resample to
any value.</p>
<p><em>Method</em>: On method, the platform performs a spline interpolation which
can be zero, linear, quadratic or cubic. Interpolating a function f(x)
consists in approximating this function by another s(x) (Figure 11),
starting from the original of the samples, so that the function s(x) has
a larger number of samples that still go through the original samples.</p>
<p><a class="reference internal" href="media/image7.png"><img alt="Interface gráfica do usuário, Aplicativo Descrição gerada automaticamente" src="media/image7.png" style="width: 6.30278in; height: 4.19583in;" /></a></p>
<p>Figure 11: Demonstration of an approximation from one function f(x) by
linear spline functions s(x) <sup>[4]</sup>.</p>
<p>On the platform CAAos, we use a <em>spline interpolation</em> of 3<sup>rd</sup>
order to resample in 5Hz the bilateral CBFv and ABP beat to beat
signals. According to the elasticity theory, if a curve is defined by a
set of points (x, y), which is named as a spline, it can be described
approximately as a piecewise function<sup>[5]</sup>. Splines are
polynomials on subintervals that are connected with a specified degree
of continuity. The order of the polynomials is not associated with the
number of data point in this case, so, we can have <em>k</em> data points, and
use a spline degree <em>n</em> where <em>k &gt;&gt; n</em>. Assuming <em>k</em> data points
(<em>x:sub:`1`, y:sub:`1`</em>), (<em>x:sub:`2`, y:sub:`2`</em>), …,
(<em>x:sub:`k`, y:sub:`k`</em>) such that <em>x:sub:`1`</em> &lt; <em>x:sub:`2
`</em>&lt;…&lt; <em>x:sub:`k`</em>, a spline function <em>y</em> of degree <em>n</em> satisfies:
(1) On each subinterval [<em>x:sub:`i`, x:sub:`i+1`</em>), <em>y</em> is a
polynomial of degree <em>n</em>. (2) The derivatives of <em>y</em> up to and including
the <em>n-1</em> derivative are continuous on the domain [<em>x:sub:`1`,
x:sub:`k`</em>].</p>
<p>The data points, when chosen such that the spline function passes
through them, are called knots. For example, a spline of degree zero is
a piecewise constant function constructed by simply assuming <em>y</em> to
have a constant value on any subinterval [<em>x:sub:`i`, x:sub:`i+1`</em>)
 (<a class="reference external" href="https://engcourses-uofa.ca/books/numericalanalysis/piecewise-interpolation/introduction/#Fig1">Figure
1</a>2).
A spline of degree 1 is a piecewise linear (piecewise affine) function
constructed by connecting a straight line between every two data points
(<a class="reference external" href="https://engcourses-uofa.ca/books/numericalanalysis/piecewise-interpolation/introduction/#Fig1">Figure
1</a>2).
A spline of degree 2 is a piecewise quadratic function on each
subinterval. The first derivative exists and is continuous, but it is
not smooth.</p>
<p>A spline of degree 3 is a piecewise cubic function on each subinterval.
The first and second derivatives are continuous functions. The second
derivative is not smooth <sup>[5]</sup>. Figure 12 shows the resulting zero
order, linear, quadratic, and cubic spline interpolation functions.</p>
<p><a class="reference internal" href="media/image25.png"><img alt="Figure 1. Piecewise interpolation using: 0 order, linear, quadratic, and cubic splines" src="media/image25.png" style="width: 6.30278in; height: 3.53681in;" /></a></p>
<p>Figure 12: Illustration of the resulting zero order, linear, quadratic,
and cubic spline interpolation functions <sup>[5]</sup>.</p>
<ul class="simple">
<li><p><em>Zero</em>: It is a spline which has degree 0, also called a step
function. This function has a constant value connecting two adjacent
samples (Figure 12).</p></li>
</ul>
<p><a class="reference internal" href="media/image26.png"><img alt="Gráfico, Gráfico de caixa estreita Descrição gerada automaticamente" src="media/image26.png" style="width: 3.83387in; height: 1.52105in;" /></a></p>
<p>Figure 12: Example of a step function (the red graphic) <sup>[4]</sup>.</p>
<ul class="simple">
<li><p><em>Linear</em>: A function S<sub>1</sub>(x) is an interpolate linear spline
function of f(x) in the points x<sub>0</sub>, x<sub>1, …,</sub>
x<sub>n</sub> and S<sub>1</sub>(x) can be written in each subinterval
([x:sub:<cite>i-1</cite>, x<sub>i</sub>], i = 1, 2, …, n) like:</p></li>
</ul>
<p><img class="math" src="_images/math/83703bed88faa7b2d9a0ec1318b7d965491cb885.png" alt="S_{i}\left( x \right) = f\left( x_{i - 1} \right)\frac{x_{\text{i\ }} - x}{x_{i} - x_{i - 1}} + f\left( x_{\text{i\ }} \right)\frac{\text{x\ }{- \ x}_{i - 1}}{x_{i} - x_{i - 1}},\ \forall\ x \in \lbrack x_{i - 1},\ x_{i}\rbrack"/>
(2)</p>
<p>By definition, S<sub>1</sub>(x) is a polynomial with degree 1 in each
subinterval [x:sub:<cite>i-1</cite>, x<sub>i</sub>];</p>
<p>S<sub>1</sub>(x) is continuous in [x:sub:<cite>i-1</cite>, x<sub>i</sub>], by
definition, and, in the points x<sub>i</sub>, S<sub>1</sub>(x) is well
defined once
<img class="math" src="_images/math/faff5f50a85a3f86569d50a5783cb86c594b45d2.png" alt="S_{i}(x_{i})\  = \ S_{i = 1}(x_{i})\  = \ f(x_{i})\  \rightarrow S_{1}(x)"/>
is continuous in [a,b] and, therefore, S<sub>1</sub>(x) is a linear
spline;</p>
<p>As an example of linear spline interpolation, we can calculate
S<sub>i</sub>(x) for the function f(x) (Figure 13) by the following
steps:</p>
<p><a class="reference internal" href="media/image7.png"><img alt="Interface gráfica do usuário, Aplicativo Descrição gerada automaticamente" src="media/image7.png" style="width: 6.30278in; height: 4.19583in;" /></a></p>
<p>Figure 13: Example of a linear spline interpolation <sup>[4]</sup>.</p>
<p>According with the definition,</p>
<p><img class="math" src="_images/math/3b8620290f515ee34b8c5ea3b197da7261dcf69b.png" alt="s_{1}\left( x \right) = f\left( x_{0} \right)\frac{x_{1} - x}{x_{1} - x_{0}} + f\left( x_{1} \right)\frac{x - x_{0}}{x_{1} - x_{0}} ="/></p>
<p><img class="math" src="_images/math/e5267aede427c9b3948215698e2ad4f589d64e0f.png" alt="= 1\ \frac{2 - x}{2 - 1} + 2\frac{x - 1}{2 - 1} = 2 - x + 2x - 2 = x,\ x \in \lbrack 1,\ 2\rbrack"/></p>
<p><img class="math" src="_images/math/5107d14397610d7882c509ebd13b890f71d5d991.png" alt="s_{2}\left( x \right) = f\left( x_{1} \right)\frac{x_{2} - x}{x_{2} - x_{1}} + f(x_{2})\frac{x - x_{1}}{x_{2} - x_{1}}"/></p>
<p><img class="math" src="_images/math/b0a61394011234ec4ab6fda8d670baa9249e83cb.png" alt="= 2\frac{5 - x}{5 - 2} + 3\frac{x - 2}{5 - 2} = \frac{2}{3}\left( 5 - x \right) + x - 2 = \frac{1}{3}\left( x + 4 \right),\ x \in \lbrack 2,5\rbrack"/></p>
<p><img class="math" src="_images/math/887de28a9ae8c5b436d079132f6554137776d123.png" alt="s_{3}\left( x \right) = f\left( x_{2} \right)\frac{x_{3} - x}{x_{3} - x_{2}} + f(x_{3})\frac{x - x_{2}}{x_{3} - x_{2}}"/></p>
<p><img class="math" src="_images/math/1af79b7cd796b26616809bd4d58377074e092abf.png" alt="= 3\frac{7 - x}{7 - 5} + 2.5\frac{x - 5}{7 - 5} = \frac{1}{2}\left( - 0.5x + 8.5 \right),\ x\  \in \left\lbrack 5,7 \right\rbrack"/></p>
<ul>
<li><p><em>Quadratic</em>:  Consider a set of <em>k</em> data points points
(<em>x:sub:`1`, y:sub:`1`</em>), (<em>x:sub:`2`, y:sub:`2`</em>), …,
(<em>x:sub:`k`, y:sub:`k`</em>), with <em>k-1</em> intervals. We seek to find
a quadratic
polynomial <img class="math" src="_images/math/e46ccf1cc641e3faeb304d7ae10047f1fbfc04b4.png" alt="s_{i}\left( x \right) = \ a_{i} + \ b_{i}x + \ c_{i}x^{2}"/> on
the <em>i:sup:`th `</em>interval <em>[x:sub:`i`, x:sub:`i+1`]</em>. In
total, there are <em>3(k-1)</em> coefficients. On each interval, the two
equations <img class="math" src="_images/math/e31c9433fb38226e2e295554834922849ce5a8e5.png" alt="s_{i}\left( x_{i} \right) = \ y_{i}"/> and <img class="math" src="_images/math/df6e4737bea87e5e8fd6940327e342501ac137b1.png" alt="s_{i}\left( x_{i + 1} \right) = \ y_{i + 1}"/> ensure
that the spline passes through the data points which also ensure the
continuity of the splines. These continuity equations will
provide <em>2(k-1)</em> equations. In addition, the connection of the
quadratic polynomials at intermediate nodes will be assumed to be
smooth, and so at every intermediate point the first derivative is
assumed to be continuous, that
is <img class="math" src="_images/math/a0ef73d07e7a12349f29e7a03eea43941c62351c.png" alt="s_{i}^{'}\left( x_{i + 1} \right) = \ s_{i + 1}^{'}\left( x_{i + 1} \right)"/>.
These first-derivative continuity equations provide
another <em>k-2</em> equations. Finally, the second derivative at the
starting point can be set to 0 to provide one additional condition so
that the number of equations would be equal to <em>3(k-1)</em> which is
equal to the number of unknowns <sup>[5]</sup>.</p>
<blockquote>
<div><div class="line-block">
<div class="line"><a class="reference internal" href="media/image24.png"><img alt="image12" src="media/image24.png" style="width: 5.72429in; height: 1.98294in;" /></a></div>
<div class="line">Figura 14: Example of a quadratic spline interpolation <sup>[5]</sup>.</div>
</div>
</div></blockquote>
</li>
<li><dl>
<dt><em>Cubic</em>: A cubic spline, S<sub>3</sub>(x), is a continuous piecewise</dt><dd><blockquote>
<div><p>function in which each piece, S<sub>k</sub>, is a polynomial of
degree 3 in an interval [x:sub:<cite>k-1</cite>, x<sub>k</sub>], k = 1, 2, …,
n. S<sub>3</sub>(x) has continuous first and second derivates,
which makes it not have peaks and neither change abruptly the
curvature around the points. Definition:</p>
</div></blockquote>
<p><img class="math" src="_images/math/76ec434b3eaf356414743377e1551ccf3dfc9cc9.png" alt="s_{k}\left( x \right) = \ a_{k}(x - \ x_{k})^{3} + b_{k}(x - \ x_{k})^{2} + \ c_{k}\left( x - \ x_{k} \right) + \ d_{k},\ k = 1,\ 2,\ \ldots,\ n"/>
(3)</p>
<p>So, the calculation of S<sub>3</sub>(x) demands the determination of
4 coefficients for each k, in total of 4n coefficients: a<sub>1</sub>,
b<sub>1</sub>, c<sub>1</sub>, d<sub>1</sub>, a<sub>2</sub>, …,
a<sub>n</sub>, b<sub>n</sub>, c<sub>n</sub>, d<sub>n</sub>. The conditions
for S<sub>3</sub>(x) to be an interpolate spline of f(x) in
x<sub>0</sub>, …, x<sub>n</sub> :</p>
<p>(n + 1) conditions for S<sub>3</sub>(x) to interpolate f(x) at its
points;</p>
<p>(n – 1) conditions for S<sub>3</sub>(x) to be well defined at these
points (continuity of S<sub>3</sub><sup>’</sup>(X) in [x:sub:<cite>0</cite>,
x<sub>n</sub>];</p>
<p>(n – 1) conditions for S’<sub>3</sub>(x) be continuous at
[x:sub:<cite>0</cite>, x<sub>n</sub>];</p>
<p><em>Calibration</em>: The chosen maximum and minimum values are applied to
the signal, defining the new amplitude range in which the signal is
settled. In “Absolute” method, the amplitude of the signal is fully
calibrated. In “5/95 percentile” method, the minimum value is
applied to the 5% of the amplitude and the maximum value to 95% of
the amplitude, therefore, the calibration is applied in the range of
5 to 95% of the signal amplitude.</p>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="sync-filter">
<h3><strong>2.2.3 Sync/Filter</strong><a class="headerlink" href="#sync-filter" title="Permalink to this headline">¶</a></h3>
<p>In this tab (Figure 15), the user is be able to synchronize the signals
(indicated by number 1 in Figure 14), if needed. On these columns
indicated by number 1, the user can select what settings will be applied
to each channel, synchronization and/or filtering. Then, the user must
click on the sync button to apply the operation to the signals (number 2
at Figure 14). The user will also be able to filter all signals after
clicking on the “Filter” button (number 3 at Figure 14).</p>
<ul class="simple">
<li><dl class="simple">
<dt><em>Sync function</em>: this tool allows performing the synchronization</dt><dd><p>between all signals, since they are acquired from different
equipment and delay might be present. Also, the systolic peaks
are physiologically correspondent in each graphic.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Sync Methods: select the method between “Correlation” or “Fixed ABP</dt><dd><p>delay”. The second option is the most applied.</p>
</dd>
</dl>
</li>
<li><p><em>Filter</em>: this function allows user to filter the signals.</p></li>
<li><dl class="simple">
<dt>Filter Type: select the type among “Moving Average”, “Median” and</dt><dd><p>“Butterworth”.</p>
</dd>
</dl>
</li>
</ul>
<p>ABP delay: It is set a delay in ABP signal in relation to the beginning
of CBFv signal. The timing placed here depends on the equipment that is
used to do the ABP reading.</p>
<p><a class="reference internal" href="media/image7.png"><img alt="Interface gráfica do usuário, Aplicativo Descrição gerada automaticamente" src="media/image7.png" style="width: 6.30278in; height: 4.19583in;" /></a></p>
<p>Figure 15: Illustration of tab Sync/Filter<strong>.</strong></p>
<p><strong>*Background*</strong></p>
<p><strong>*Synchronization:*</strong> The synchronization of the CBFv and ABP signals
can be done by a fixed delay or by Cross correlation.</p>
<ul class="simple">
<li><p><strong>*Cross correlation*:</strong> The cross correlation between the ABP and
CBFv signals is calculated, and the highest cross-correlation’s peak
will represent a point where there is a strong similarity between
them, the instant of time in the highest peak is identified and used
to synchronized both signals, shifting on of them.</p></li>
</ul>
<p><strong>*Filter:*</strong> an ideal filter perfectly selects the desired frequencies
and reject the unwanted ones from the input signal, causing no more than
a delay as a distortion of the signal. In this section of CAAos
platform, the user may use the following filters: Moving Average filter,
Median filter, and Butterworth filter.</p>
<ul class="simple">
<li><p><strong>*Moving Average Filter:*</strong> Moving Average filters are extremely
common in digital signal processing because they have an easy
implementation and are efficient on removing noises. The system is
called moving average because the results of its application obtain
the average of N samples positioned on the last input sequence sample
<sup>[6]</sup>.</p></li>
</ul>
<p>A system of moving average of N – 1 order is defined by:</p>
<p><img class="math" src="_images/math/a5ed9da4775ae2e0cdc3a0cdfd165453f1db1025.png" alt="y\left\lbrack n \right\rbrack = \ \frac{1}{N}\ x\lbrack n - k\rbrack"/>
(4)</p>
<p>Where n is the current time, <em>N</em> - 1 is the number of samples used on
the filtration, y[n] is the filtered signal and x[n-k] represents the
set of values that will be summed.</p>
<ul class="simple">
<li><p><strong>*Median Filter:*</strong> A median is a value that separates a half with
bigger values from another half with smaller values of a sample,
i.e., a median is the middle value among a set of data. Therefore,
the Median filter allows to reduce the noise by: first through an
ordering of values in the neighborhood region (region in the signal
with at least n + 1 points and it is all the same value), second
through the preservation of edges (continuous ascent or descent with
constant neighborhood), third through the removing of impulses (set
of n points with different values comparing with the around
neighborhood values), and, lastly, through a smoothing of the
oscillations <sup>[7 – 8]</sup>.</p></li>
</ul>
<p>The median filter is an effective method that can, to some extent,
distinguish out-of-range isolated noise from legitimate <sup>[9]</sup>.
Specifically, the median filter replaces a sample by the median, instead
of the average, of all samples in a neighborhood <img class="math" src="_images/math/16cb1e006199f0853a2dc67ea814446a38beb54e.png" alt="\omega"/>.</p>
<p><img class="math" src="_images/math/876242c751b193f6ed9a16710761f34b0016080d.png" alt="y\left\lbrack m \right\rbrack = median\{ x\left\lbrack i \right\rbrack,\ \left( i \right) \in \ \omega\}"/>
(5)</p>
<p>where <img class="math" src="_images/math/16cb1e006199f0853a2dc67ea814446a38beb54e.png" alt="\omega"/>  represents a neighborhood defined by the user,
centered around the location of the sample m in the signal <sup>[9]</sup>.</p>
<ul class="simple">
<li><p><strong>*Butterworth filter:*</strong> The Butterworth filter is an approximation
function developed to obtain a flatter response on the passband
(continuous frequency set of electrical signals). A Butterworth
function has the following equation:</p></li>
</ul>
<p><img class="math" src="_images/math/4a553aaa70c8551c693ee5fda347f1aaf591c750.png" alt="\left| H(\Omega) \right|^{2} = \ \frac{1}{1 + {(\frac{\Omega}{\Omega_{c}})}^{2N}}"/>
(6)</p>
<p><sup>[10]</sup> (See Figure 16).</p>
<p><a class="reference internal" href="media/image33.png"><img alt="Interface gráfica do usuário Descrição gerada automaticamente" src="media/image33.png" style="width: 5.24130in; height: 2.91468in;" /></a></p>
<p>Figure 16: Illustration of the function Butterworth, which shows that
the higher values N takes, the greater is the descent, making the
transition band better <sup>[10]</sup>.</p>
</div>
<div class="section" id="artefact-removal">
<h3><strong>2.2.4 Artefact Removal</strong><a class="headerlink" href="#artefact-removal" title="Permalink to this headline">¶</a></h3>
<p>All signals can be visually inspected to identify artefacts and noise,
and narrow spikes may be removed by following these steps (Figure 17):</p>
<p>First, the user visually inspects all the recorded data. If an artefact
has to be removed, the user moves the (gray) cursor until the artifact
(number 1 in Figure 17). Secondly, the user chooses the “Region Type” to
select the area to be excluded (number 2 in Figure 17). Then, select the
“Methods” to be applied. The methods for artefact removal implemented
are linear interpolation, crop and join peaks (see section 2.2.4.1 for
explanation).</p>
<p><a class="reference internal" href="media/image34.png"><img alt="Interface gráfica do usuário, Texto, Aplicativo Descrição gerada automaticamente" src="media/image34.png" style="width: 6.59375in; height: 3.30414in;" /></a></p>
<p>Figure 17: Illustration of Artefact Removal tab.</p>
<div class="section" id="interpolated-method">
<h4><strong>2.2.4.1 Interpolated Method</strong><a class="headerlink" href="#interpolated-method" title="Permalink to this headline">¶</a></h4>
<p>This method makes a new interpolating function to gather the interval by
approximating the values and removing the artefact. It is indicated to
remove small artefacts.</p>
<p><img alt="image16" src="media/image1.jpg" /></p>
<p>Figure 18: Illustration of the Interpolate method for Artefact Removal.</p>
</div>
<div class="section" id="crop">
<h4><strong>2.2.4.2 Crop</strong><a class="headerlink" href="#crop" title="Permalink to this headline">¶</a></h4>
<p>This method makes a forced join between the extremes of the selection by
deleting the part selected and overlapping what left. <a class="reference internal" href="media/image32.jpg"><img alt="image17" src="media/image32.jpg" style="width: 6.70344in; height: 2.64583in;" /></a></p>
<blockquote>
<div><p>Figure 19: Illustration of the Crop method for Artefact Removal.</p>
</div></blockquote>
</div>
<div class="section" id="join-peaks">
<h4><strong>2.2.4.3 Join Peaks</strong><a class="headerlink" href="#join-peaks" title="Permalink to this headline">¶</a></h4>
<p>This method cuts periods comprised within the selection window and joins
the borders of the selection. It is indicated to remove larger
artefacts.<a class="reference internal" href="media/image4.jpg"><img alt="image18" src="media/image4.jpg" style="width: 6.49028in; height: 2.27083in;" /></a></p>
<p>Figure 20: Illustration of Join Peaks method in Artefact Removal.</p>
<p>Caution: Removing large ranges of the signals can compromise the
autoregulation analysis.</p>
</div>
</div>
<div class="section" id="r-r-peak-detection">
<h3><strong>2.2.5 R-R peak detection</strong><a class="headerlink" href="#r-r-peak-detection" title="Permalink to this headline">¶</a></h3>
<p>The platform finds the systolic peaks on the ABP signal for each cardiac
cycle. There are two different methods implemented for R-R detection:
<em>automatic multiscale-based peak detection</em> (AMPD) or the Prof. Marcos
Duarte (MD) method. After that, the detected peaks (red marks in Figure
21) are extrapolated to bilateral CBFv signals (and EtCO2, if that is
the case as well) once the user clicks the button “Find RR Marks”, the
signals will be shown similarly in Figure 21.</p>
<blockquote>
<div><p><a class="reference internal" href="media/image21.png"><img alt="Interface gráfica do usuário, Aplicativo, Tabela, Excel Descrição gerada automaticamente" src="media/image21.png" style="width: 5.94496in; height: 3.18340in;" /></a></p>
<p>Figure 21: Illustration of RR detection tab.</p>
</div></blockquote>
<p><strong>*Background*</strong></p>
<p><strong>*R-R detection:*</strong></p>
<p><strong>- *AMPD method*:</strong> The automatic multiscale-based peak detection
(AMPD) is an algorithm which aims to have the following properties: not
having “free parameters values” chosen by the user before the analysis;
being able to detect peaks of periodic signals; and having an efficient
detection of peaks which is developed against high and low frequency
noises <sup>[11]</sup>.</p>
<p><strong>- *MD method:*</strong> consists to detect peaks (local maxima) or valleys
(local minima) in data, one way to do this is to use the property that a
peak (or valley) must be greater (or smaller) than its immediate
neighbors. The function detect_peaks.py from Python module detects
peaks (or valleys) based on this feature and other characteristics
<sup>[12]</sup>.</p>
</div>
<div class="section" id="beat-to-beat-surrogate-signal">
<h3><strong>2.2.6 Beat-to-beat surrogate signal</strong><a class="headerlink" href="#beat-to-beat-surrogate-signal" title="Permalink to this headline">¶</a></h3>
<p>The last tab of the preprocessing module generates the surrogate
beat-to-beat from the load signals. To generate the beat-to-beat
signals, an upsampling is needed, to allow equidistant sampling
intervals and preserving the relevant frequency range components of
cerebral autoregulation. CARNet<sup>[3]</sup> suggests cubic interpolation
at 5 Hz. After interpolation, it is recommended to filter the
beat-to-beat signals with a “moving Average” filter <sup>[3]</sup>, see
figure below. After the settings, the user needs to press the button
“Extract beat-to-beat” and the platform will present the signals
organized like the image below. The user also need to press the bottom
“Filter” to visualize the signals filtered.</p>
<p><a class="reference internal" href="media/image13.png"><img alt="image20" src="media/image13.png" style="width: 5.88542in; height: 3.25000in;" /></a></p>
<p>Figure 22: Illustration of beat-to-beat tab.</p>
<p>After doing this, the user can click in “save all”, which will create a
“. job” file. This file contains all the preprocessing data.</p>
<p><strong>*Background*</strong></p>
<p><strong>*Beat to Beat:*</strong> Once the onset (heart’s systole) on the curves of
ABP and CBFv is defined, the platform calculates the average values of
these signals in each heartbeat cycle. With the peaks marked on the R-R
detection, each heartbeat is represented as the center sample value
between the peaks’ sample values, and, in this interval, the average
becomes the new order of the beat-to-beat signal. Thereby, the obtained
signals are averages of ABP and CBFv in each heartbeat, having a low
sampling frequency (&lt; 2 Hz) which makes it necessary to perform an
upsampling to 4Hz or 5Hz through a cubic spline interpolation (Figure
23) <sup>[3]</sup>.</p>
<p><a class="reference internal" href="media/image10.png"><img alt="Diagrama Descrição gerada automaticamente com confiança média" src="media/image10.png" style="width: 2.58175in; height: 2.02875in;" /></a></p>
<p>Figure 23: Illustration of interpolation and resampling process
according to the calculation of the beat-to-beat average values in each
heart cycle <sup>[3]</sup>.</p>
</div>
</div>
<div class="section" id="autoregulation-analysis">
<h2><strong>2.3 Autoregulation Analysis</strong><a class="headerlink" href="#autoregulation-analysis" title="Permalink to this headline">¶</a></h2>
<p>To start cerebral autoregulation analysis, the user opens
“Autoregulation Analysis” in “toolboxes” or with CTRL+T to load the
saved “. job” file. Figure 22 illustrates the opening page of the
autoregulation analysis toolbox. The cerebral autoregulation analysis is
performed by the power spectrum density (PSD) analysis, transfer
function analysis (TFA) and autoregulatory index (ARI) analysis. It is
important to highlight that the CAAos platform performs the cerebral
autoregulation analysis in each cerebral hemisphere independently.</p>
<p>PS: The “.job” document must be in the same directory as the text file
that contains the patient data.</p>
<p><a class="reference internal" href="media/image7.png"><img alt="Interface gráfica do usuário, Aplicativo Descrição gerada automaticamente" src="media/image7.png" style="width: 6.30278in; height: 4.19583in;" /></a></p>
<p>Figure 24: Illustration of Autoregulation Analysis first page.</p>
<div class="section" id="power-spectrum-density-psd">
<h3><strong>2.3.1 Power Spectrum Density (PSD)</strong><a class="headerlink" href="#power-spectrum-density-psd" title="Permalink to this headline">¶</a></h3>
<p>To apply the TFA, it is necessary to calculate the PSD of ABP and CBFv
signals, as shown by the following procedures.</p>
<ul class="simple">
<li><dl class="simple">
<dt>First, the user needs to select Welch’s method parameters: segment</dt><dd><p>length, overlap window type (indicated by number 1 in Figure 25),
PSD filter type and number of taps (number 2 in Figure 25). The
platform default parameters are set as: segment length of 100 s,
segment overlap of 50%, Hanning window and a triangular filter
type, which is the configuration recommended by the literature
<sup>[13]</sup>. The user can also choose the options “remove bias
from segment”, which performs linear detrending and “use
beat-to-beat data” – as opposed to using the filtered signals in
100 Hz</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Next, the user must click on “Compute PSD” to create the three</dt><dd><p>spectra: ABP’s Auto spectrum, CBFv’s Auto spectrum and ABP and
CBFv Cross spectrum for each cerebral hemisphere. After that, the
user can save the generated plots as an image by clicking “Save
PSD data”.</p>
</dd>
</dl>
</li>
</ul>
<p><a class="reference internal" href="media/image17.png"><img alt="Gráfico, Aplicativo Descrição gerada automaticamente" src="media/image17.png" style="width: 6.30278in; height: 4.17153in;" /></a></p>
<p>Figure 25: Illustration of PSD tab.</p>
<p><strong>*Background*</strong></p>
<p><strong>*Power Spectra Density (PSD):*</strong> The power spectrum is commonly
defined as the Fourier transform of the autocorrelation function
<sup>[10]</sup>.</p>
<p>A popular method for evaluating the power spectrum is the direct
approach. The direct approach is motivated by the fact that the energy
contained in a digital signal, x[n], is related to the magnitude of the
signal squared integrated over time <sup>[10]</sup>:</p>
<p><img class="math" src="_images/math/867fb0ccb63ee9c49dee50e5d3b12b03cfdf8782.png" alt="E = \ \left| x\lbrack n\rbrack \right|^{2}"/> (7)</p>
<p>Hence |X(f)|<sup>2</sup> equals the energy density function over
frequency, also referred to as the energy spectral density, the power
spectral density (PSD). In the direct approach the power spectrum is
calculated as the magnitude squared of the Fourier transform (or Fourier
series) of the waveform of interest <sup>[10]</sup>:</p>
<p><img class="math" src="_images/math/582322fa340cc005b1ba2490ca7e0655ec9c1a60.png" alt="\text{PSD}\left( f \right) = \ \left| x\lbrack n\rbrack \right|^{2}"/>
(8)</p>
<p>For each x<sub>p</sub>[n] segment, its modified periodogram
S<sub>p</sub><sup>xx</sup>(f) is computed as:</p>
<p><img class="math" src="_images/math/7037efb39f54cf5a7e02323e6787b9360f2fbe8e.png" alt="S_{p}^{\text{xx}}\left( f_{k} \right) = \frac{T_{s}}{{\| w\|}^{2}}\ X_{p}^{w}(f_{k})"/>
(9)</p>
<p><img class="math" src="_images/math/74191ae63e8c9c53518c981c81a8518065a2294f.png" alt="{\| w\|}^{2} = \ {(w\left\lbrack n \right\rbrack)}^{2}"/> (10)</p>
<p>where w[n], n=0, …, L-1 is a given window function, :math:`` stands
for complex conjugate and <img class="math" src="_images/math/da71cc5f9b467600cbea7e75672f510451ab8570.png" alt="X_{p}^{w}(f_{k})"/> is the Fourier
Transform of the windowed signal, here defined as:</p>
<p><img class="math" src="_images/math/e7d09fcc7625edada4922a4add74344dcd79adb9.png" alt="X_{p}^{w}\left( f_{k} \right) = \ \ {x\left\lbrack n \right\rbrack w\left\lbrack n \right\rbrack\text{\ e}}^{\frac{- j2\pi nk}{L}}\"/>
(11)</p>
<p><img class="math" src="_images/math/0bf956c1d89e2be1d80b4788da99ccbd6279ff63.png" alt="f_{k} = \ \frac{k}{LT_{S}}"/> (12)</p>
<p>where  <img class="math" src="_images/math/e8f6ffa1331575b71df65efd021c7080c669d8ed.png" alt="j = \"/> is the imaginary unit and
<img class="math" src="_images/math/0bf956c1d89e2be1d80b4788da99ccbd6279ff63.png" alt="f_{k} = \ \frac{k}{LT_{S}}"/> is the associated frequency.</p>
<p>Finally, the estimated auto spectrum density of x[n] is given by the
average of the modified periodograms
<img class="math" src="_images/math/5aef18937b203c965a01775547ee019eee6352e5.png" alt="S_{p}^{\text{xx}}\left( f_{k} \right)"/></p>
<p><img class="math" src="_images/math/1e8631574ea7b7cb65e3986d4e5aa0458ec46ec7.png" alt="S^{\text{xx}}\left( f_{k} \right) = \ \frac{1}{P}S_{p}^{\text{xx}}\left( f_{k} \right)"/>
(13)</p>
<p>In case of cross spectrum between signals x[n] and y[n], eq. (3) and (7)
are replaced by</p>
<p><img class="math" src="_images/math/d5f98e71414b27d6d81469696d262919817e51af.png" alt="S_{p}^{\text{xy}}\left( f_{k} \right) = \frac{T_{s}}{{\| w\|}^{2}}\ Y_{p}^{w}(f_{k})"/>
(14)</p>
<p><img class="math" src="_images/math/81caa7cdf26ec54c48c772c2913d0b4bb5bbb39c.png" alt="S^{\text{xy}}\left( f_{k} \right) = \ \frac{1}{P}S_{p}^{\text{xy}}\left( f_{k} \right)"/>
(15)</p>
<p>In this work x[n] is the ABP signal and y[n] is the CBFv signal. The
cross-spectrum of CBFv with relation to ABP on each side of the brain
quantifies how Much of the CBFv signal is explained by the ABP signal in
each frequency band.</p>
<p><strong>*Windowing:*</strong> The Windows are discrete sequences that, in CAAos
platform, have the function of minimizing the distortions which are
caused by <em>spectral leakage</em>. Thereby, four different windows are
implemented in the platform: Triangular, Hanning, Hamming and Tukey
windows.</p>
<ul class="simple">
<li><p><em>Triangular</em>: The triangular window is given by the function</p></li>
</ul>
<p><sup>[6]</sup>:</p>
<p><img class="math" src="_images/math/5fe1fe147ac583bd39d912be8a1d04bb0063d563.png" alt="w\left\lbrack n \right\rbrack = \{\frac{2n}{N - 1},\ \ if\ 0 \leq n \leq \frac{N - 1}{2}\ 2 - \ \frac{2n}{N - 1},\ \ if\ \frac{N - 1}{2} &lt; n &lt; N\ 0,\ \ out\ of\ interval\"/>
(16)</p>
<p><a class="reference internal" href="media/image23.png"><img alt="image24" src="media/image23.png" style="width: 5.21875in; height: 2.32992in;" /></a></p>
<p>Figure 26: Illustration of triangular window <sup>[13]</sup>.</p>
<ul class="simple">
<li><p><em>Hanning</em>: The Hanning window is given by <sup>[6]</sup>:</p></li>
</ul>
<p><img class="math" src="_images/math/beae7dad3c32a8bc33fc8c9cee42220880993db4.png" alt="w\left\lbrack n \right\rbrack = \{ 0,5 - 0,5\ cos\frac{2\pi n}{N - 1},\ \ if\ 0 \leq n \leq N\ 0,\ \ out\ of\ interval\"/>
(17)</p>
<p><a class="reference internal" href="media/image18.png"><img alt="image25" src="media/image18.png" style="width: 5.15625in; height: 2.33327in;" /></a></p>
<p>Figure 27: Hanning window<sup>[14]</sup>.</p>
<ul class="simple">
<li><p><em>Hamming</em>: The Hamming window is given by <sup>[6]</sup>:</p></li>
</ul>
<p><img class="math" src="_images/math/2471ad8c923e316b851aae2097215aa6633214c6.png" alt="w\left\lbrack n \right\rbrack = \{ 0,54 - 0,46\ cos\frac{2\pi n}{N - 1},\ \ if\ 0 \leq n \leq N\ 0,\ \ out\ of\ interval\"/>
(18)</p>
<p><a class="reference internal" href="media/image5.png"><img alt="image26" src="media/image5.png" style="width: 5.18264in; height: 2.28125in;" /></a></p>
<p>Figure 28: Hamming window<sup>[13]</sup>.</p>
<ul class="simple">
<li><p><em>Tukey</em>: The Tukey window is given by <sup>[13]</sup>:</p></li>
</ul>
<p><img class="math" src="_images/math/b8215e3fe2d001100abb50c6164e26f2b47528a9.png" alt="w\left\lbrack n \right\rbrack = \{\frac{1}{2}\left\{ 1 + cos\left( \frac{2\pi}{r}\left\lbrack n - \frac{r}{2} \right\rbrack \right) \right\},\ \ if\ 0 \leq n \leq \frac{r}{2}\ 1\ ,\ \ \ if\ \frac{r}{2} \leq n \leq 1 - \frac{r}{2}\ \ \frac{1}{2}\left\{ 1 + cos\left( \frac{2\pi}{r}\left\lbrack n - 1 + \ \frac{r}{2} \right\rbrack \right) \right\},\ if\ 1 - \frac{r}{2} \leq n \leq 1\ \"/>
(19)</p>
<p>The parameter <em>rr</em></p>
<p><a class="reference internal" href="media/image8.png"><img alt="image27" src="media/image8.png" style="width: 5.40625in; height: 2.37968in;" /></a></p>
<p>Figure 29: Tukey window<sup>[13]</sup>.</p>
<p><strong>*Welch method:*</strong> Welch’s method obtains the average of modified
periodograms (when the window is not rectangular). The periodogram is an
estimate of the power spectrum. So, the sequency x(n) (equation 20) is
divided in K equal segments with a window w(n) of length L <sup>[10]</sup>:</p>
<p><img class="math" src="_images/math/e422c50ed1dd273c61f6fe05d25b091a038ce368.png" alt="x_{r}\left( n \right) = x\left( rR + n \right)w\left( n \right);\ \ \ \ \ \ 0 \leq n \leq L - 1,\ 1 \leq r \leq K"/>
(20)</p>
<p>The segments can be contiguous (R=L) or not (R&lt;L). The periodogram of
segment <em>r</em> is:</p>
<p><img class="math" src="_images/math/84ee3b1ec5e4f21dfaad1a9df9073774935e32c3.png" alt="{\widehat{s}}_{r}\left( \omega \right) = \ \frac{1}{\text{LU}}\left| V_{r}(\omega) \right|^{2}"/>
(21)</p>
<p>where the <em>U</em> is normalization factor that compensates the bias in the
estimative and <img class="math" src="_images/math/61dc9e6755ad1e01c47b89dac4f3a8dc226ed63d.png" alt="V_{r}(\omega)"/> is a finite length of the signal.</p>
<p>The medium periodograma is defined by:</p>
<p><img class="math" src="_images/math/b8e7abbfff3867da5884a23e13fe9f3706e500ad.png" alt="\text{\ \ }\left( \omega \right) = \ \frac{1}{K}\ {\widehat{s}}_{r}"/>
(22)</p>
<p>In order to avoid problems of transfer and of intersegment dependency,
it is convenient to use a non-rectangular window. Thereby, in the
platform, the signals are divided in segments of 100 seconds with an
overlap of 50% in time domain. Then, each segment is multiplied by the
Hanning window, aiming to reduce the distortion. Lastly, the platform
takes a moving average filter of triangular window with coefficients ¼,
½, ¼ to a greater smoothing of the signal <sup>[3]</sup>.</p>
<p>To estimate the PSD, the software applies the Discrete Fourier Transform
(equation 14) in the post Welch method signal, obtaining the values for
the TFA analysis.</p>
<p><img class="math" src="_images/math/ab5691c3fbf7c53c17cb57027272aa48c66f9877.png" alt="V\left( e^{j\omega} \right) = x\left\lbrack n \right\rbrack w\lbrack n\rbrack e^{- j\omega n}"/>
(23)</p>
<blockquote>
<div><p><strong>2.3.2 Transfer Function Analysis (TFA)</strong></p>
</div></blockquote>
<hr class="docutils" />
<p>In this tab, the platform will calculate the TFA, generating values of
gain, phase and coherence by the following procedures.</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt>Firstly, select the TFA method (indicated by number 1 at Figure 30).</dt><dd><p>The user may choose to use or not the option “Use coherence
threshold” and “Ignore negative Phase”. Please, see the coherence
threshold according to the 5 minutes recordings <sup>[3]</sup></p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Then, the user must click on “Compute TFA” for obtaining the plots of</dt><dd><p>Gain, Phase and Coherence, and export their values.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>The TFA results are divided into three frequency ranges: Very Low</dt><dd><p>Frequency (VLF), between 0.02-0.07Hz, Low Frequency (LF), between
0.07-0.2Hz, and High Frequency (HF), between 0.2-0.5Hz).</p>
</dd>
</dl>
</li>
</ol>
<p>The user can save it as document “.tf” by clicking on “Save TFA data”.</p>
<p><a class="reference internal" href="media/image12.png"><img alt="Diagrama Descrição gerada automaticamente" src="media/image12.png" style="width: 4.28571in; height: 2.85460in;" /></a></p>
<p>Figure 30: Illustration of TFA tab.</p>
<p><strong>*Background*</strong></p>
<p><strong>*Transfer Function Analysis (TFA):*</strong> TFA is a method to calculate
parameters that reflect the dynamic of the cerebral autoregulation (CA)
system assuming that the relation between ABP and CBFv is linear. With
this assumption, the TFA is based on the Fourier decomposition of
stationary signals of input and output, putting it in a sum of sine and
cosine in multiple frequencies. Hence, the input senoidal signals are
transformed in output senoidal signals of same frequency, however with a
difference on amplitude (Gain) and a change on time domain (Phase)
<sup>[3]</sup> – Figure 30.</p>
<p><a class="reference internal" href="media/image12.png"><img alt="Diagrama Descrição gerada automaticamente" src="media/image12.png" style="width: 4.28571in; height: 2.85460in;" /></a></p>
<p>Figure 30: Illustration of Gain and Phase <sup>[14]</sup>.</p>
<p>To verify if the Gain and the Phase are reliable, the platform also
calculates the Coherence Function to help identify segments that
presents inconsistencies (figure 31). The Coherence variates amid 0 and
1, which values nearby 0 presents low reliability and values nearby 1
presents high reliability. The mean squared coherence quantifies the
linearity degree between ABP and CBFv in each frequency value, therefore
if low values of coherence are observed, the computation of the average
TFA parameters in each preconized <sup>[3]</sup> frequency band disregards
the corresponding samples.</p>
<p><a class="reference internal" href="media/image16.png"><img alt="Diagrama, Esquemático Descrição gerada automaticamente" src="media/image16.png" style="width: 5.11938in; height: 3.70755in;" /></a>.</p>
<p>Figure 31: Illustration of analysis of gain, phase and coherence
<sup>[3]</sup>.</p>
<p>Furthermore, gain, phase, and coherence (respectively, equations 23, 24
and 25) are calculated from auto-spectrum (equation 26) and
cross-spectrum (equation 27), which are given by <sup>[15]</sup>:</p>
<p><img class="math" src="_images/math/be5f971b9c33104137ec14cecc0dd0be2c2fb008.png" alt="\left| H\left( f \right) \right| = \"/></p>
<ol class="arabic simple" start="23">
<li></li>
</ol>
<p><img class="math" src="_images/math/1cdcc88abf0415b90a00aa9ec71f5855d7b65114.png" alt="\varnothing\left( f \right) = \left\lbrack \frac{H_{I}(f)}{H_{R}(f)} \right\rbrack\"/>
(24)</p>
<p><img class="math" src="_images/math/5dda23f7d1bc555b931e9ff22dbe1938a7266da6.png" alt="\gamma^{2}\left( f \right) = \frac{|{S_{\text{xy}}\left( f \right)|}^{2}}{S_{\text{xx}}(f)*S_{\text{yy}}(f)}"/>
(25)</p>
<p><img class="math" src="_images/math/d3a15fab924a1ea23fbbfa5d494319e452664a80.png" alt="S_{\text{xx}}(f) = E|X\left( f \right)X^{*}\left( f \right)|"/>
(26)</p>
<p><img class="math" src="_images/math/8662298672eeeab8e2085d4c49d2548a60171214.png" alt="S_{\text{xy}}(f) = E|X\left( f \right)Y^{*}\left( f \right)|"/>
(27)</p>
<p>Where <em>X</em> and <em>Y</em> are power spectrums of ABP and CBFv. The Transfer
Function H(f) (equation 28) <sup>[14]</sup>, with the assumption of
linearity <sup>[2]</sup>, allows us to observe variations of CBFv in
alterations of ABP, demonstrating a physiological system that has ABP as
input and CBFv as output.</p>
<p><img class="math" src="_images/math/8d471852e6612d915bc9d33ffec78469a587e06a.png" alt="H\left( f \right) = \frac{S_{\text{xy}}(f)}{S_{\text{xx}}(f)}"/>
(28)</p>
</div>
<div class="section" id="autoregulation-index-analysis-ari">
<h3><strong>2.2.3 Autoregulation Index Analysis (ARI)</strong><a class="headerlink" href="#autoregulation-index-analysis-ari" title="Permalink to this headline">¶</a></h3>
<p>The ARI quantifies the cerebral autoregulation in a range between 0 and
9 (Figure 32), which 0 means absence of autoregulation and 9 the maximum
of autoregulation. Thus, a preserved autoregulation usually presents ARI
between 4-6.</p>
<p><a class="reference internal" href="media/image6.png"><img alt="image31" src="media/image6.png" style="width: 4.08095in; height: 2.33662in;" /></a></p>
<p>Figure 32: Response of CA model to a shift in a ABP step (Tiecks et al.
1995) .</p>
<ul class="simple">
<li><p>First, the user needs to define the response time according to the
wanted interval. It usual to use 10 seconds as response time. Once
this is done, the user can save the ARI in a “. ARI” file and finish
the analysis of the patient. In the tab ARI, the platform presents
the patient’s curve and the equivalent ARI curve (see Figure 33).</p></li>
</ul>
<p><a class="reference internal" href="media/image11.jpg"><img alt="Gráfico, Gráfico de linhas Descrição gerada automaticamente" src="media/image11.jpg" style="width: 6.16667in; height: 3.80000in;" /></a></p>
<p>Figure 33: ARI result of a health patient.</p>
<p><strong>*Background *</strong></p>
<p><strong>*Autoregulation Index*:</strong> The values of CBFv and ABP are utilized to
calculate ARI which reflects a change in the cerebrovascular resistance
per second comparing with the physiological changes in the ABP. A
computer calculates a hypothetical curve of CBFv without the CA. This
curve assumes that CBFv passively follows ABP’s course, i.e., the
percentual variations of CBFv and ABP are equal. Thereby, if the current
curve of CBFv of a random test fits in this computational model, the ARI
will be 0. Other nine possible curves of computational models of CBFv
were calculated, quantifying the autoregulation in a range of 0 to 9,
where 0 indicates an absence of CA and 9 the maximum CA. In normal
conditions of CA, the value of ARI is 5±1 <sup>[16]</sup>. Values lower than
4 indicates a failure of the CA mechanism, while ARI = 0 is a simulation
of passive response in all variation of ABP which reflects in variations
of CBFv. The effect of CA on CBFv can be approximated by differential
equations of second order with state variables x<sub>1</sub> and
x<sub>2</sub>, which are related to CBFv changes in response of a change
of ABP. The four following equations are proposals to obtain the ARI
method: :math:``</p>
<p>For ARI estimation, the inverse Fourier transform of the Transfer
Function <em>H(f)</em>, obtained in TFA method, is applied, converting data
back to the time domain. In the time domain, the impulse response
function (IRF) is computed with a cut-off frequency of 0.5Hz. The IRF
represents the CBFv temporal response to a very short, impulse-like
disturbance in ABP. If the IRF remains flat, CBFv lacks feedback
reaction and tend to follow ABP changes, characterizing absence of
autoregulation. On the other hand, perfect CA is represented by a
positive immediate change counteracted by a negative wave in the IRF,
indicating a return of CBFv to its original level after ABP disturbance.
Then, IRF is used to predict the CBFv step response to ABP changes
<sup>[13]</sup>. The step response function is obtained with the time
integral of IRF. It represents the CBFv temporal response to a steplike
disturbance in ABP. ARI is assigned to each CBFv recording by using the
best least squares fit between the CBFv step response and one of the 10
template curves proposed by Tiecks et al (1995) to provide an ARI
estimate, which varies between absence of CA (ARI=0) to best observed CA
(ARI=9).</p>
<p>For the calculation of the 10 ARI curves proposed by Tiecks (1995), CA
effect on CBFv is approximated by a second-order differential equations
set with state variables x<sub>1</sub> and x<sub>2</sub>, related to changes
in CBFv in response to an abrupt change in ABP. The following 4
equations are proposed to obtain the ARI method:</p>
<p><img class="math" src="_images/math/625f64b53d4a344b3be721aebdc2c7a12fb22628.png" alt="dP(t)\  = \ \frac{P(t)\  - \ Pm}{Pm\  - \ CrCP}"/> (28)</p>
<p><img class="math" src="_images/math/a7d448e83c4217b3941e28c831bb628d778081c2.png" alt="v(t)\  = \ v_{M}(1\  + \ dP(t)\  - \ kx_{2}(t))"/> (29)</p>
<p><img class="math" src="_images/math/ebd499f22366fe914d7b0214ec5cd7338f1a32b0.png" alt="x_{1}(t)\  = \ x_{1}(t\  - 1)\  + \ \frac{dP(t)\  - \ x_{2}(t - 1)}{\text{fT}}\text{\ \ }"/>
(31)</p>
<p><img class="math" src="_images/math/3433d1fe10e8e55c9b6af1d6e84e105b424932c4.png" alt="x_{2}(t)\  = \ x_{2}(t\  - 1)\  + \ \frac{x_{1}(t)\  - 2D\ x_{2}(t - 1)}{\text{fT}}"/>
(32)</p>
<p>Where dP is the normalized variation between the mean ABP (P (t))
between beats, and its control value (Pm), in relation to its value of
the critical closing pressure (CrCP, defined as 12 mmHg, Tiecks et al
1995). The segmentation of each heart cycle is done in the CAAos
platform, described previously, in the beat-by-beat analysis, in which
the mean ABP and CBFv values are obtained for each heartbeat. The
variables x<sub>1</sub> and x<sub>2</sub> are of states in the second order
system for a given number of samples (n); v<sub>M</sub> is the mean CBFv,
f the sampling frequency and T the time constant.</p>
<p>The difference between step response function (SRF) and each template
curve <em>v(t)</em>, is estimated through the root mean square error (RMSE),
described in equation 33. The curve that presents the lower RMSE is
consider the best fit to the patient step response and defines the ARI
integer value.</p>
<p><img class="math" src="_images/math/b9f39994c6d6e7942dc528a8ec97fe94ecd03603.png" alt="RMSE\  = \"/> (33)</p>
<p>Thereafter, parabolic interpolation using neighboring values of the
optimal ARI was employed to obtain estimates with two decimal places.
This interpolation implemented uses the Finite Difference Method of
parabolic equation, considering that ARI decimal value is obtained with
the vertex of the parabolic curve, as described in equations 34 to 37.</p>
<p><img class="math" src="_images/math/e1782b52e72663da5f0cf718a84c5ea42c4ceb72.png" alt="p\left( x \right) = ax^{2} + bx + c"/> (34)</p>
<p><img class="math" src="_images/math/5c060d9afdf04d1fb17b9a6194861c42c0c90430.png" alt="Xv = \  - \frac{b}{2a}"/> (35)</p>
<p><img class="math" src="_images/math/083043c6547dee298bf2acd755a188530d1eecb5.png" alt="p^{''}\left( x \right) = \frac{p\left( x + h \right) - 2p\left( x \right) + p(x - h)}{h^{2}}\text{\ \ \ \ }"/>
(36)</p>
<p><img class="math" src="_images/math/435a6a2e5d344819ee30bdb4a34d2e20677fbe9d.png" alt="Xv = x + \ \frac{p\left( x + 1 \right) - p\left( x - 1 \right)}{2 \bullet (2p\left( x \right) - p\left( x + 1 \right) - p\left( x - 1 \right))}"/>
(37)</p>
<p>Where <em>p(x)</em> is the polynomial parabolic equation, <em>X:sub:`v`</em> is the
point of vertex. The Finite Difference Method of parabolic equation is
presented in equation 36, where <em>x</em> is the ARI integer value, and <em>h</em>
the distance between ARI value and its neighbors.</p>
</div>
</div>
</div>
<div class="section" id="references">
<h1><strong>References</strong><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h1>
<p>[1] Payne, S. Cerebral Autoregulation: Control of Bood Flow in the Brain
– SpringerBriefs in Bioengineering, University of Oxford, Oxford, UK.
2016.</p>
<p>[2] Liandra A. F. Yoshida, September 25, 2017. Federal University of
ABC, PROPES.</p>
<p>[3] Claassen JA, Meel-van den Abeelen AS, Simpson DM, Panerai RB;
international Cerebral Autoregulation Research Network (CARNet).
Transfer function analysis of dynamic cerebral autoregulation: A white
paper from the International Cerebral Autoregulation Research Network. J
Cereb Blood Flow Metab. 2016 Apr;36(4):665-80.</p>
<p>[4] Ruggiero, MAG. Lopes, VLR. Cálculo numérico: aspectos teóricos e
computacionais. 2<sup>nd</sup> edition. São Paulo: Pearson; 2000.</p>
<p>[5] Dow K, Adeeb S, Westlover L, Li W, Qiu W; (2021). Introduction to
Numerical Analysis for Engineers. Retrieved from
<a class="reference external" href="https://engcourses-uofa.ca">https://engcourses-uofa.ca</a>.</p>
<p>[6] Nalon, JA. Intodução ao Processamento de Sinais. Rio de Janeiro:
LTC; 2013.</p>
<p>[7] Sá, JPM. Processamento de Sinal: Conceitos, Métodos e Aplicações.
Porto: Faculdade de Engenharia da Universidade do Porto. 2001.
<a class="reference external" href="https://web.fe.up.pt/~jmsa/apsi/APSI-2.PDF">https://web.fe.up.pt/~jmsa/apsi/APSI-2.PDF</a>.</p>
<p>[8] Junior, GB. Filtros e Morfologia. Maranhão: Universidade Federal do
Maranhão. <a class="reference external" href="https://nca.ufma.br/~geraldo/vc/4.filtros.pdf">https://nca.ufma.br/~geraldo/vc/4.filtros.pdf</a>.</p>
<p>[9] Median Filter, Harvey Mudd College engineering. January, 2019.
<a class="reference external" href="http://fourier.eng.hmc.edu/e161/lectures/smooth_sharpen/node2.html">http://fourier.eng.hmc.edu/e161/lectures/smooth_sharpen/node2.html</a>.</p>
<p>[10] Semmlow, John, Signals, and systems for bioengineers, 2 ed.,
Elsevier Inc, 2012.</p>
<p>[11] Scholkmann, F. Boss, J. Wolf, M. An Efficient Algorithm for
Automatic Peak Detection in Noisy Periodic and Quasi-Periodic Signals.
Algorithms. 2012.</p>
<p>[12] Duarte, M. Detection of peaks in data. São Paulo: Universidade
Federal do ABC.
<a class="reference external" href="https://github.com/demotu/BMC/blob/master/notebooks/DetectPeaks.ipynb">https://github.com/demotu/BMC/blob/master/notebooks/DetectPeaks.ipynb</a>.</p>
<p>[13] MathWorks, Inc. Spectral Windows. Available at:
<a class="reference external" href="https://www.mathworks.com/help/signal/windows.html">https://www.mathworks.com/help/signal/windows.html</a>.</p>
<p>[14] Van Beek A, Claassen JH, Marcel GM, de Rikkert OI, René WMM.
Cerebral autoregulation: an overview of currentconcepts and methodology
with special focus on the elderly. J Cerebr Blood Flow Metab,
2008;28:1071–1085.</p>
<p>[15] Panerai, RB. Cerebral Autoregulation: From Models to Clinical
Applications. Cardiovasc Eng, 2008;8, 42–59.</p>
<p>[16] Tiecks, FM; Lam, AM et al. Comparison of Static and Dynamic
Cerebral Autoregulation Measurements. Stroke 1995 26:1014-1019.</p>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Fernando Moura, Angela Salinet, João Salinet Júnior.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>