

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>patientData &mdash; CAAos Platform 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> CAAos Platform
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CAAos Platform</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>patientData</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for patientData</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/bin/python</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. warning:: Include here brief description of this module</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span> <span class="k">as</span> <span class="n">ETree</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span> <span class="k">as</span> <span class="n">scipySignal</span>

<span class="kn">import</span> <span class="nn">tools</span>
<span class="kn">from</span> <span class="nn">ARI</span> <span class="kn">import</span> <span class="n">ARIanalysis</span>
<span class="kn">from</span> <span class="nn">PSDestimator</span> <span class="kn">import</span> <span class="n">PSDestimator</span>
<span class="kn">from</span> <span class="nn">signals</span> <span class="kn">import</span> <span class="n">signal</span>
<span class="kn">from</span> <span class="nn">TFA</span> <span class="kn">import</span> <span class="n">transferFunctionAnalysis</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;0.2&#39;</span>


<div class="viewcode-block" id="patientData"><a class="viewcode-back" href="../index.html#patientData.patientData">[docs]</a><span class="k">class</span> <span class="nc">patientData</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Patient data base class</span>

<span class="sd">    This is the base class to process cerebral autoregulation data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    inputFile : str</span>
<span class="sd">        File with patient&#39;s data. Accepted files: **.EXP**, **.DAT** (Raw Data file) or **.PPO** (preprocessing operation file)</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="patientData.getVersion"><a class="viewcode-back" href="../index.html#patientData.patientData.getVersion">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">getVersion</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the current version of the module</span>

<span class="sd">        **Example**</span>

<span class="sd">        &gt;&gt;&gt; from patientData import patientData as pD</span>
<span class="sd">        &gt;&gt;&gt; myCase=pD(&#39;data.EXP&#39;)</span>
<span class="sd">        &#39;0.1&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">__version__</span></div>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputFile</span><span class="p">,</span> <span class="n">activeModule</span><span class="p">):</span>
        <span class="c1"># input file:  .EXP-DAT  or .JOB</span>
        <span class="c1"># activeModule- Valid options: &#39;preprocessing&#39;, &#39;ARanalysis&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activeModule</span> <span class="o">=</span> <span class="n">activeModule</span>

        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dirName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filePrefix</span><span class="p">,</span> <span class="n">extension</span><span class="p">]</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">splitPath</span><span class="p">(</span><span class="n">inputFile</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hasRRmarks</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hasB2Bdata</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hasPSDdata_L</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hasPSDdata_R</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_L</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_R</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hasARIdata_L</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hasARIdata_R</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">historySignals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">historyOperations</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">extension</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.exp&#39;</span><span class="p">,</span> <span class="s1">&#39;.dat&#39;</span><span class="p">,</span> <span class="s1">&#39;.csv&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">newJob</span><span class="p">(</span><span class="n">inputFile</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">extension</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.job&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadJob</span><span class="p">(</span><span class="n">inputFile</span><span class="p">)</span>

<div class="viewcode-block" id="patientData.newJob"><a class="viewcode-back" href="../index.html#patientData.patientData.newJob">[docs]</a>    <span class="k">def</span> <span class="nf">newJob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputFile</span><span class="p">):</span>
        <span class="c1"># creates a new job with the input data file. This function also loads data from the EXP and DAT  files</span>
        <span class="c1"># this function should be called only for preprocessing steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DATAfileName</span> <span class="o">=</span> <span class="n">inputFile</span>
        <span class="c1"># create operationsTree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jobRootNode</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jobRootNode</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVersion</span><span class="p">())</span>

        <span class="c1"># create InputFile Element</span>
        <span class="p">[</span><span class="nb">dir</span><span class="p">,</span> <span class="n">filePrefix</span><span class="p">,</span> <span class="n">extension</span><span class="p">]</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">splitPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DATAfileName</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">extension</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.EXP&#39;</span><span class="p">,</span> <span class="s1">&#39;.DAT&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DATAfileType</span> <span class="o">=</span> <span class="s1">&#39;EXP_DAT&#39;</span>
        <span class="k">if</span> <span class="n">extension</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.CSV&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DATAfileType</span> <span class="o">=</span> <span class="s1">&#39;CSV&#39;</span>

        <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobRootNode</span><span class="p">,</span> <span class="s1">&#39;inputFile&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">filePrefix</span> <span class="o">+</span> <span class="n">extension</span><span class="p">,</span> <span class="n">attribList</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DATAfileType</span><span class="p">]])</span>

        <span class="c1"># create a operations node for new operations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createNewOperation</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loadDATAfile</span><span class="p">()</span></div>

<div class="viewcode-block" id="patientData.loadJob"><a class="viewcode-back" href="../index.html#patientData.patientData.loadJob">[docs]</a>    <span class="k">def</span> <span class="nf">loadJob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputFile_Job</span><span class="p">):</span>
        <span class="c1"># parse JOB file into ETree</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">XMLParser</span><span class="p">(</span><span class="n">remove_blank_text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jobRootNode</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">inputFile_Job</span><span class="p">,</span> <span class="n">parser</span><span class="p">)</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DATAfileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirName</span> <span class="o">+</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobRootNode</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;inputFile&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">createNewOperation</span><span class="p">()</span>

        <span class="c1"># import operationsFile</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobRootNode</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;operationsFile&#39;</span><span class="p">):</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobRootNode</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jobRootNode</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">importOperations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirName</span> <span class="o">+</span> <span class="n">elem</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">runOperations</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loadDATAfile</span><span class="p">()</span>

        <span class="c1"># run all operations</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobRootNode</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;operations/preprocessing&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">runPreprocessingOperations</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activeModule</span> <span class="o">==</span> <span class="s1">&#39;ARanalysis&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobRootNode</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;operations/ARanalysis&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">runARanalysisOperations</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span></div>

<div class="viewcode-block" id="patientData.importOperations"><a class="viewcode-back" href="../index.html#patientData.patientData.importOperations">[docs]</a>    <span class="k">def</span> <span class="nf">importOperations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputFile_PPO_ARO</span><span class="p">,</span> <span class="n">elemPosition</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">runOperations</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># imports the operations contained in inputFile_ARO file</span>
        <span class="c1"># if elemPosition=None: add to the end</span>

        <span class="c1"># check for file type errors</span>
        <span class="p">[</span><span class="nb">dir</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">ext</span><span class="p">]</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">splitPath</span><span class="p">(</span><span class="n">inputFile_PPO_ARO</span><span class="p">)</span>
        <span class="c1"># if (self.activeModule == &#39;preprocessing&#39;) and ext != &#39;.ppo&#39;:</span>
        <span class="c1">#  print(&#39;ERROR: importOperations in -&gt;Preprocessing&lt;- module requires .ppo file! exiting...&#39;)</span>
        <span class="c1">#  exit(-1)</span>

        <span class="n">parser</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">XMLParser</span><span class="p">(</span><span class="n">remove_blank_text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">operationRootNode</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">inputFile_PPO_ARO</span><span class="p">,</span> <span class="n">parser</span><span class="p">)</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>

        <span class="n">operationRootNode</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;imported&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;True&#39;</span>
        <span class="n">operationRootNode</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;operationsFile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">inputFile_PPO_ARO</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">elemPosition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jobRootNode</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">elemPosition</span><span class="p">,</span> <span class="n">operationRootNode</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jobRootNode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">operationRootNode</span><span class="p">)</span>

        <span class="c1"># creates a new operators Node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createNewOperation</span><span class="p">()</span>

        <span class="c1"># run all operations</span>
        <span class="k">if</span> <span class="n">runOperations</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activeModule</span> <span class="o">==</span> <span class="s1">&#39;preprocessing&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">operationRootNode</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">runPreprocessingOperations</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activeModule</span> <span class="o">==</span> <span class="s1">&#39;ARanalysis&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobRootNode</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;ARanalysis&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">runARanalysisOperations</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_removeEmptyOperations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parentElement</span><span class="p">):</span>
        <span class="s2">&quot;removes recursivelly empty elements&quot;</span>

        <span class="c1"># source: https://stackoverflow.com/questions/12694091/python-lxml-how-to-remove-empty-repeated-tags</span>
        <span class="k">def</span> <span class="nf">recursively_empty</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="nb">all</span><span class="p">((</span><span class="n">recursively_empty</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">()))</span>

        <span class="n">context</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">iterwalk</span><span class="p">(</span><span class="n">parentElement</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">action</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">context</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;operations&#39;</span><span class="p">:</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">recursively_empty</span><span class="p">(</span><span class="n">elem</span><span class="p">):</span>
                    <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>

<div class="viewcode-block" id="patientData.createNewOperation"><a class="viewcode-back" href="../index.html#patientData.patientData.createNewOperation">[docs]</a>    <span class="k">def</span> <span class="nf">createNewOperation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;creates new operations Nodes. Before that cleans up any empty operators Element in the Tree.&quot;</span>
        <span class="c1"># removes any empty operations Node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_removeEmptyOperations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobRootNode</span><span class="p">)</span>

        <span class="c1"># create a operations node for new operations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operationsNode</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobRootNode</span><span class="p">,</span> <span class="s1">&#39;operations&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attribList</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;imported&#39;</span><span class="p">,</span> <span class="s1">&#39;False&#39;</span><span class="p">]])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">PPoperationsNode</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operationsNode</span><span class="p">,</span> <span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attribList</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activeModule</span> <span class="o">==</span> <span class="s1">&#39;ARanalysis&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ARoperationsNode</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operationsNode</span><span class="p">,</span> <span class="s1">&#39;ARanalysis&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attribList</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="patientData.storeState"><a class="viewcode-back" href="../index.html#patientData.patientData.storeState">[docs]</a>    <span class="k">def</span> <span class="nf">storeState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">historySignals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">historyOperations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PPoperationsNode</span><span class="p">))</span></div>

<div class="viewcode-block" id="patientData.undoState"><a class="viewcode-back" href="../index.html#patientData.patientData.undoState">[docs]</a>    <span class="k">def</span> <span class="nf">undoState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">historyOperations</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">historySignals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PPoperationsNode</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">historyOperations</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signals</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">historySignals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="patientData.loadDATAfileHeader"><a class="viewcode-back" href="../index.html#patientData.patientData.loadDATAfileHeader">[docs]</a>    <span class="k">def</span> <span class="nf">loadDATAfileHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load header data from raw data files **.exp**, **.dat**.</span>

<span class="sd">        This function is usually used in the begining to extract general information from the file. This function is automatically called from :meth:`loadData`</span>

<span class="sd">        **Header format**</span>

<span class="sd">        The expected header format is::</span>

<span class="sd">            Patient Name: XXXXX                                                       \\ H</span>
<span class="sd">            birthday:DD:MM:YYYY                                                       | E</span>
<span class="sd">            Examination:DD:M:YYYY HH:MM:SS                                            | A</span>
<span class="sd">            Sampling Rate: XXXHz                                                      | D</span>
<span class="sd">            Time	Sample	&lt;CH_0_label&gt;	&lt;CH_1_label&gt;	...   &lt;CH_N_label&gt;    | E    &lt;- Labels: (columns separated by tabs)</span>
<span class="sd">            HH:mm:ss:ms	N	&lt;CH_0_unit&gt;	&lt;CH_1_unit&gt;	...   &lt;CH_N_unit&gt;     / R    &lt;-  Units: (columns separated by tabs)</span>
<span class="sd">            00:00:00:00	0	0	45	...	14.8	                                  &lt;-- table of data starts here</span>
<span class="sd">            00:00:00:10	1	0	46	...	16.8</span>
<span class="sd">            ...</span>


<span class="sd">        This function extracts only the following fields from the header</span>

<span class="sd">        * Sampling Rate</span>
<span class="sd">        * Number of channels</span>
<span class="sd">        * Channel info: label and unit</span>

<span class="sd">        **Notes**</span>

<span class="sd">        * The number of channels is stored in the attribute :attr:`nChannels`.</span>
<span class="sd">        * The sampling rate is stored in the attribute :attr:`samplingRate_Hz`. The value of this attribute is sent to instances of :class:`~signals.signal` after calling :meth:`loadData` and this attribute is removed after that</span>
<span class="sd">        * Channel labels and units are stored in the attribute :attr:`signalLabels` and :attr:`signalUnits`. The values of these attributes are sent to instances of :class:`~signals.signal` after calling :meth:`loadData`  and these attributes are removed after that</span>

<span class="sd">        **Example**</span>

<span class="sd">        &gt;&gt;&gt; from patientData import patientData as pD</span>
<span class="sd">        &gt;&gt;&gt; myCase=pD(&#39;data.EXP&#39;)</span>
<span class="sd">        &gt;&gt;&gt; myCase.loadDATAfileHeader()</span>
<span class="sd">        &gt;&gt;&gt; myCase.samplingRate_Hz</span>
<span class="sd">        100.0</span>
<span class="sd">        &gt;&gt;&gt; myCase.nChannels</span>
<span class="sd">        4</span>
<span class="sd">        &gt;&gt;&gt; myCase.signalLabels</span>
<span class="sd">        [&#39;Time&#39;, &#39;Sample&#39;, &#39;MCA_L_To_Probe_Env&#39;, &#39;MCA_R_To_Probe_Env&#39;, &#39;Analog_1&#39;, &#39;Analog_8&#39;]</span>
<span class="sd">        &gt;&gt;&gt; myCase.signalUnits</span>
<span class="sd">        [&#39;HH:mm:ss:ms&#39;, &#39;N&#39;, &#39;cm/s&#39;, &#39;cm/s&#39;, &#39;mV&#39;, &#39;mV&#39;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DATAfileName</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DATAfileType</span> <span class="o">==</span> <span class="s1">&#39;EXP_DAT&#39;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sizeHeader</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c1"># extract examination date</span>
                <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">while</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Examination&#39;</span><span class="p">):</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sizeHeader</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">12</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">:%m:%Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
                    <span class="n">time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">12</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="n">delf</span><span class="o">.</span><span class="n">examDate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>  <span class="c1">#: Examination Date.</span>

                <span class="c1"># extract sampling frequency in Hz</span>
                <span class="k">while</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Sampling Rate&#39;</span><span class="p">):</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sizeHeader</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">samplingRate_Hz</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>

                <span class="c1"># next 2 lines should contain labels and units</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">signalLabels</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">signalUnits</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">nChannels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signalUnits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sizeHeader</span> <span class="o">+=</span> <span class="mi">2</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DATAfileType</span> <span class="o">==</span> <span class="s1">&#39;CSV&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">samplingRate_Hz</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

                <span class="c1"># next 2 lines should contain labels and units</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">signalLabels</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">signalUnits</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sizeHeader</span> <span class="o">=</span> <span class="mi">3</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">nChannels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signalUnits</span><span class="p">)</span></div>


<div class="viewcode-block" id="patientData.loadDATAfile"><a class="viewcode-back" href="../index.html#patientData.patientData.loadDATAfile">[docs]</a>    <span class="k">def</span> <span class="nf">loadDATAfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads patient data from raw data files **.EXP**, **.DAT**.</span>

<span class="sd">        This function is used to load data files into memory. This function calls :meth:`loadHeader` internally, so you don&#39;t have to call it manually.</span>

<span class="sd">        **Notes**</span>

<span class="sd">        * Each channel information is stored in one instance of :class:`~signals.signal`. They are accessible via :class:`~signals.signals`</span>

<span class="sd">        * In the end of this function, the attributes :attr:`samplingRate_Hz`, :attr:`signalLabels` and :attr:`signalUnits` are removed. This information is passed to the instances of :class:`~signals.signal`</span>

<span class="sd">        **Example**</span>

<span class="sd">        &gt;&gt;&gt; from patientData import patientData as pD</span>
<span class="sd">        &gt;&gt;&gt; myCase=pD(&#39;data.EXP&#39;)</span>
<span class="sd">        &gt;&gt;&gt; myCase.loadEXPDAT()</span>
<span class="sd">        &gt;&gt;&gt; myCase.signals[0]</span>
<span class="sd">        &lt;signals.signal instance at 0x7f8744e6e710&gt;</span>
<span class="sd">        &gt;&gt;&gt; s.signals[0].info()   # shows information of channel 0</span>
<span class="sd">        -------------------------------</span>
<span class="sd">        Channel: 0</span>
<span class="sd">        label: MCA_L_To_Probe_Env</span>
<span class="sd">        unit: cm/s</span>
<span class="sd">        sigType: None</span>
<span class="sd">        nPoints: 30676</span>
<span class="sd">        -------------------------------</span>
<span class="sd">        &gt;&gt;&gt; myCase.signals[1].info()   # shows information of channel 1</span>
<span class="sd">        -------------------------------</span>
<span class="sd">        Channel: 1</span>
<span class="sd">        label: MCA_R_To_Probe_Env</span>
<span class="sd">        unit: cm/s</span>
<span class="sd">        sigType: None</span>
<span class="sd">        nPoints: 30676</span>
<span class="sd">        -------------------------------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadDATAfileHeader</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DATAfileType</span> <span class="o">==</span> <span class="s1">&#39;EXP_DAT&#39;</span><span class="p">:</span>
            <span class="c1"># create dtype of the file</span>
            <span class="n">dtypes</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;U11&#39;</span><span class="p">,</span> <span class="s1">&#39;i4&#39;</span><span class="p">)</span>  <span class="c1"># col 0: time (11 char string)   col 1: frame (32 bit int)</span>
            <span class="n">dtypes</span> <span class="o">=</span> <span class="n">dtypes</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;f8&#39;</span><span class="p">,)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nChannels</span>  <span class="c1"># the other columns will be treated as float (8bits)</span>

            <span class="n">rawData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DATAfileName</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sizeHeader</span><span class="p">,</span> <span class="n">autostrip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signalLabels</span><span class="p">),</span>
                                    <span class="n">dtype</span><span class="o">=</span><span class="n">dtypes</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DATAfileType</span> <span class="o">==</span> <span class="s1">&#39;CSV&#39;</span><span class="p">:</span>
            <span class="c1"># create dtype of the file</span>
            <span class="n">dtypes</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;f8&#39;</span><span class="p">,)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nChannels</span>  <span class="c1"># the other columns will be treated as float (8bits)</span>

            <span class="n">rawData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DATAfileName</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sizeHeader</span><span class="p">,</span> <span class="n">autostrip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signalLabels</span><span class="p">),</span>
                                    <span class="n">dtype</span><span class="o">=</span><span class="n">dtypes</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">signals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nChannels</span><span class="p">):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signalLabels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">newSignal</span> <span class="o">=</span> <span class="n">signal</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">signalUnits</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">rawData</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">samplingRate_Hz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">samplingRate_Hz</span><span class="p">,</span>
                               <span class="n">operationsXML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">PPoperationsNode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newSignal</span><span class="p">)</span>

        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">signalLabels</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">signalUnits</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">samplingRate_Hz</span></div>

<div class="viewcode-block" id="patientData.saveSIG"><a class="viewcode-back" href="../index.html#patientData.patientData.saveSIG">[docs]</a>    <span class="k">def</span> <span class="nf">saveSIG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filePath</span><span class="p">,</span> <span class="n">channelList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save data to a text file.</span>

<span class="sd">        This function is usually used to save processed signals</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filePath : string</span>
<span class="sd">            Full path to the file. Extension is not needed since a **.SIG** will be automatically added to the end of the filename. If path has an extension, this function will replace the extension by **.SIG**</span>

<span class="sd">        channelList : list of integers, optional</span>
<span class="sd">            List of channels to save. If `None` (default) then all channels are saved in the file.</span>

<span class="sd">        format : string, optional</span>
<span class="sd">            File format. Avaiable values: &#39;csv&#39;, &#39;numpy&#39;, &#39;simple_text&#39;</span>

<span class="sd">        **Notes**</span>

<span class="sd">        * This function calls :meth:`~signals.signal.saveData` from each instance of :class:`~signals.signal` in the list of channels.</span>

<span class="sd">        * See :meth:`~signals.signal.saveData` for details about the output file format.</span>

<span class="sd">        **Example**</span>

<span class="sd">        &gt;&gt;&gt; from patientData import patientData as pD</span>
<span class="sd">        &gt;&gt;&gt; myCase=pD(&#39;data.EXP&#39;)</span>
<span class="sd">        &gt;&gt;&gt; myCase.loadData()</span>
<span class="sd">        &gt;&gt;&gt; for i in range(x.nChannels):</span>
<span class="sd">        &gt;&gt;&gt;    x.signals[i].resample(100,method=&#39;quadratic&#39;) # resamples all channels at 100Hz, using quadratic interpolation</span>
<span class="sd">        &gt;&gt;&gt; myCase.signals[2].calibrate(80,120,method=&#39;percentile&#39;) # calibrates channel 2  (presure) between 80 and 120mmHg, using percentile method</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; myCase.saveSignals(fileName=&#39;/full/path/output1.SIG&#39;,channelList=None)  # saves all channels in output1.SIG</span>
<span class="sd">        &gt;&gt;&gt; myCase.saveSignals(fileName=&#39;/full/path/output2.SIG&#39;,channelList=[0,2])  # saves only channels 0 and 2 in output2.SIG</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving signal data...&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">channelList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">channelList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nChannels</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
            <span class="n">outputFile</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">setFileExtension</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fOut</span><span class="p">:</span>
                <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CHANNEL;&#39;</span> <span class="o">+</span> <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">channel</span><span class="p">)</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;LABEL;&#39;</span> <span class="o">+</span> <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;UNIT;&#39;</span> <span class="o">+</span> <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SIGNAL_TYPE;&#39;</span> <span class="o">+</span> <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">sigType</span><span class="p">)</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SAMPLING_RATE_(Hz);&#39;</span> <span class="o">+</span> <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">samplingRate_Hz</span><span class="p">)</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;N_SAMPLES;&#39;</span> <span class="o">+</span> <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">nPoints</span><span class="p">)</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;-------DATA START-------;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="c1"># build tuple  (time;ch0,ch1,...)</span>
                <span class="n">listSignals</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getTimeVector</span><span class="p">()]</span>  <span class="c1"># add time</span>
                <span class="n">stringHeader</span> <span class="o">=</span> <span class="s1">&#39;TIME (s)&#39;</span>
                <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">:</span>
                    <span class="n">listSignals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># add signals</span>
                    <span class="n">stringHeader</span> <span class="o">+=</span> <span class="s1">&#39;;ch</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">ch</span>

                <span class="n">signals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">listSignals</span><span class="p">))</span>

                <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stringHeader</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fOut</span><span class="p">,</span> <span class="n">signals</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.8e</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;-------DATA END-------;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;numpy&#39;</span><span class="p">:</span>
            <span class="n">outputFile</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">setFileExtension</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s1">&#39;.npy&#39;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>

            <span class="c1"># build a structured array</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">sigType</span><span class="p">),</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">samplingRate_Hz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">getTimeVector</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">]</span>

            <span class="c1"># find sizes</span>
            <span class="n">sizeLabel</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">])</span>
            <span class="n">sizeUnit</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">])</span>
            <span class="n">sizeSigType</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">sigType</span><span class="p">))</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">])</span>
            <span class="n">sizeData</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">])</span>

            <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([(</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;U</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sizeLabel</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="s1">&#39;U</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sizeUnit</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sigType&#39;</span><span class="p">,</span> <span class="s1">&#39;U</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sizeSigType</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;samplingRate_(Hz)&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;time_(s)&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="n">sizeData</span><span class="p">,)),</span> <span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="n">sizeData</span><span class="p">,))])</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;simple_text&#39;</span><span class="p">:</span>
            <span class="n">outputFile</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">setFileExtension</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s1">&#39;.sig&#39;</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">)</span>
            <span class="n">fileObj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">saveData</span><span class="p">(</span><span class="n">fileObj</span><span class="p">)</span>

            <span class="n">fileObj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">register</span><span class="p">:</span>
            <span class="n">xmlElement</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;SIGsave&#39;</span><span class="p">)</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;channels&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">channelList</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;fileName&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filePath</span><span class="p">))</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PPoperationsNode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmlElement</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ok!&#39;</span><span class="p">)</span></div>

        <span class="c1"># channelList: list or None.  List with the channels to save.</span>

<div class="viewcode-block" id="patientData.saveB2B"><a class="viewcode-back" href="../index.html#patientData.patientData.saveB2B">[docs]</a>    <span class="k">def</span> <span class="nf">saveB2B</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filePath</span><span class="p">,</span> <span class="n">channelList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save beat-to-beat data to a text file.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filePath : string</span>
<span class="sd">            Full path to the file. Extension is not needed since a **.B2B** will be automatically added to the end of the filename. If path has an extension, this function will replace the extension by **.B2B**</span>

<span class="sd">        channelList : list of integers, optional</span>
<span class="sd">            List of channels to save. If `None` (default) then all channels are saved in the file.</span>

<span class="sd">        format : string, optional</span>
<span class="sd">            File format. Avaiable values: &#39;csv&#39;, &#39;numpy&#39;, &#39;simple_text&#39;</span>

<span class="sd">        **Notes**</span>

<span class="sd">        * This function will save beat-to-beat data only if Beat-to-beat analysis was performed before. See :meth:`getBeat2beat`.</span>
<span class="sd">        * This function calls :meth:`~signals.signal.saveB2B` from each instance of :class:`~signals.signal` in the list of channels.</span>

<span class="sd">        * See :meth:`~signals.signal.saveB2B` for details about the output  file format.</span>

<span class="sd">        **Example**</span>

<span class="sd">        &gt;&gt;&gt; from patientData import patientData as pD</span>
<span class="sd">        &gt;&gt;&gt; myCase=pD(&#39;data.EXP&#39;)</span>
<span class="sd">        &gt;&gt;&gt; myCase.loadData()</span>
<span class="sd">        &gt;&gt;&gt; myCase.findRRmarks(refChannel=2,method=&#39;ampd&#39;) # find RR marks with channel 2 as reference and ampd method</span>
<span class="sd">        &gt;&gt;&gt; myCase.getBeat2beat(resampleRate_Hz=5.0,resampleMethod=&#39;cubic&#39;) # extract beat-to beat data and resample at 5Hz</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; myCase.saveBeat2beat(fileName=&#39;/full/path/output1.B2B&#39;,channelList=None)  # saves all channels in output1.SIG</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasB2Bdata</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No beat-to-beat data was found. Canceling save...&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving beat-to-beat data...&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">channelList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">channelList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nChannels</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
            <span class="n">outputFile</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">setFileExtension</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fOut</span><span class="p">:</span>
                <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;CHANNEL;&#39;</span> <span class="o">+</span> <span class="s1">&#39;;;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">channel</span><span class="p">)</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;LABEL;&#39;</span> <span class="o">+</span> <span class="s1">&#39;;;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;UNIT;&#39;</span> <span class="o">+</span> <span class="s1">&#39;;;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SIGNAL_TYPE;&#39;</span> <span class="o">+</span> <span class="s1">&#39;;;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">sigType</span><span class="p">)</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;SAMPLING_RATE_(Hz);&#39;</span> <span class="o">+</span> <span class="s1">&#39;;;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">samplingRate_Hz</span><span class="p">)</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;N_SAMPLES;&#39;</span> <span class="o">+</span> <span class="s1">&#39;;;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">beat2beatData</span><span class="o">.</span><span class="n">nPoints</span><span class="p">)</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;-------DATA START-------;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="c1"># build tuple  (time;ch0,ch1,...)</span>
                <span class="n">listSignals</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">beat2beatData</span><span class="o">.</span><span class="n">xData</span><span class="p">]</span>  <span class="c1"># add time</span>
                <span class="n">stringHeader</span> <span class="o">=</span> <span class="s1">&#39;TIME (s)&#39;</span>
                <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">:</span>
                    <span class="n">avgVec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">beat2beatData</span><span class="o">.</span><span class="n">avg</span>
                    <span class="n">minVec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">beat2beatData</span><span class="o">.</span><span class="n">min</span>
                    <span class="n">maxVec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">beat2beatData</span><span class="o">.</span><span class="n">max</span>
                    <span class="n">listSignals</span> <span class="o">+=</span> <span class="p">[</span><span class="n">avgVec</span><span class="p">,</span> <span class="n">minVec</span><span class="p">,</span> <span class="n">maxVec</span><span class="p">]</span>
                    <span class="n">stringHeader</span> <span class="o">+=</span> <span class="s1">&#39;;AVG ch</span><span class="si">%d</span><span class="s1">;MIN ch</span><span class="si">%d</span><span class="s1">;MAX ch</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="n">ch</span><span class="p">,</span> <span class="n">ch</span><span class="p">)</span>

                <span class="n">signals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">listSignals</span><span class="p">))</span>

                <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stringHeader</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fOut</span><span class="p">,</span> <span class="n">signals</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.8e</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;-------DATA END-------;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;numpy&#39;</span><span class="p">:</span>
            <span class="n">outputFile</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">setFileExtension</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s1">&#39;.npy&#39;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>

            <span class="c1"># build a structured array</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">sigType</span><span class="p">),</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">samplingRate_Hz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">beat2beatData</span><span class="o">.</span><span class="n">xData</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">beat2beatData</span><span class="o">.</span><span class="n">avg</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">beat2beatData</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">beat2beatData</span><span class="o">.</span><span class="n">max</span><span class="p">)</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">]</span>

            <span class="c1"># find sizes</span>
            <span class="n">sizeLabel</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">])</span>
            <span class="n">sizeUnit</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">])</span>
            <span class="n">sizeSigType</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">sigType</span><span class="p">))</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">])</span>
            <span class="n">sizeData</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">beat2beatData</span><span class="o">.</span><span class="n">xData</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">])</span>

            <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([(</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;U</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sizeLabel</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="s1">&#39;U</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sizeUnit</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sigType&#39;</span><span class="p">,</span> <span class="s1">&#39;U</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sizeSigType</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;samplingRate_(Hz)&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;time_(s)&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="n">sizeData</span><span class="p">,)),</span> <span class="p">(</span><span class="s1">&#39;avg&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="n">sizeData</span><span class="p">,)),</span>
                           <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="n">sizeData</span><span class="p">,)),</span> <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="n">sizeData</span><span class="p">,))])</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;simple_text&#39;</span><span class="p">:</span>
            <span class="n">outputFile</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">setFileExtension</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s1">&#39;.b2b&#39;</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">)</span>
            <span class="n">fileObj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">saveB2B</span><span class="p">(</span><span class="n">fileObj</span><span class="p">)</span>

            <span class="n">fileObj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">register</span><span class="p">:</span>
            <span class="n">xmlElement</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;B2Bsave&#39;</span><span class="p">)</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;channels&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">channelList</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;fileName&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filePath</span><span class="p">))</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PPoperationsNode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmlElement</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ok!&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="patientData.saveJob"><a class="viewcode-back" href="../index.html#patientData.patientData.saveJob">[docs]</a>    <span class="k">def</span> <span class="nf">saveJob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">mergeImported</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the history of operations applied to the file.</span>

<span class="sd">        This functions saves all operations applied to the data, in the correct order. This allows for re-run the analysis on the same file or apply the same set of operations to different cases.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fileName : string</span>
<span class="sd">            Full path to the file. If the path has an extension, this function will replace the extension by the corresponding default extension,</span>
<span class="sd">            based on :arg:`section` argument</span>

<span class="sd">            file extension. As default:</span>
<span class="sd">            - **.PPO**: (Preprocessing operations)</span>
<span class="sd">            - **.ARO**: (Autoregulation operations)</span>

<span class="sd">        mergeImported: bool, optional</span>
<span class="sd">            If True, any imported opereations will be merged into de job file. Otherwise only the link to the operation file will be kept.</span>
<span class="sd">            (Default: False)</span>

<span class="sd">        section: strings</span>
<span class="sd">            Describes the section of the operations to save. Use oe of the following: &#39;preprocessing&#39;, &#39;ARanalysis&#39;</span>

<span class="sd">        **PPO/ARO file formats**</span>

<span class="sd">        See :ref:`ppo_aro_file_format_label` for details about **.PPO** and **.ARO** file formats.</span>


<span class="sd">        **Example**</span>

<span class="sd">        &gt;&gt;&gt; from patientData import patientData as pD</span>
<span class="sd">        &gt;&gt;&gt; myCase=pD(&#39;data.EXP&#39;)</span>
<span class="sd">        &gt;&gt;&gt; myCase.loadData()</span>
<span class="sd">        &gt;&gt;&gt; for i in range(x.nChannels):</span>
<span class="sd">        &gt;&gt;&gt;    x.signals[i].resample(100,method=&#39;quadratic&#39;) # resamples all channels at 100Hz, using quadratic interpolation</span>
<span class="sd">        &gt;&gt;&gt; myCase.signals[2].calibrate(80,120,method=&#39;percentile&#39;) # calibrates channel 2  (presure) between 80 and 120mmHg, using percentile method</span>
<span class="sd">        &gt;&gt;&gt; myCase.findRRmarks(refChannel=2,method=&#39;ampd&#39;) # find RR marks with channel 2 as reference and ampd method</span>
<span class="sd">        &gt;&gt;&gt; myCase.getBeat2beat(resampleRate_Hz=5.0,resampleMethod=&#39;cubic&#39;) # extract beat-to beat data and resample at 5Hz</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; myCase.saveJob(fileName=&#39;/full/path/output1.PPO&#39;)</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">outputTree</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobRootNode</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving .job data...&#39;</span><span class="p">)</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">setFileExtension</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s1">&#39;.job&#39;</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">)</span>

        <span class="c1"># remove empty entities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_removeEmptyOperations</span><span class="p">(</span><span class="n">outputTree</span><span class="p">)</span>

        <span class="c1"># keep the links to the files in case mergeImported=False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mergeImported</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">position</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">outputTree</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;operations&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemAttrXpath</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">attrName</span><span class="o">=</span><span class="s1">&#39;imported&#39;</span><span class="p">,</span> <span class="n">attrType</span><span class="o">=</span><span class="s1">&#39;bool&#39;</span><span class="p">):</span>
                        <span class="n">outputTree</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
                        <span class="n">newElem</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;operationsFile&#39;</span><span class="p">)</span>
                        <span class="n">newElem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemAttrXpath</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">attrName</span><span class="o">=</span><span class="s1">&#39;operationsFile&#39;</span><span class="p">,</span> <span class="n">attrType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                        <span class="n">outputTree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">newElem</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">outputTree</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">,</span> <span class="n">xml_declaration</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">fileOut</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>

        <span class="n">fileOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">fileOut</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ok!&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="patientData.runPreprocessingOperations"><a class="viewcode-back" href="../index.html#patientData.patientData.runPreprocessingOperations">[docs]</a>    <span class="k">def</span> <span class="nf">runPreprocessingOperations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operationsElem</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply the operations previously loaded.</span>

<span class="sd">        **Note**</span>

<span class="sd">        This function os automatically called during the initialization  :meth:`__init__` if the input is a **.PPO** file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">operation</span> <span class="ow">in</span> <span class="n">operationsElem</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;resample&#39;</span><span class="p">,</span> <span class="s1">&#39;setLabel&#39;</span><span class="p">,</span> <span class="s1">&#39;setUnit&#39;</span><span class="p">,</span> <span class="s1">&#39;synchronize&#39;</span><span class="p">,</span> <span class="s1">&#39;findRRmarks&#39;</span><span class="p">,</span> <span class="s1">&#39;B2Bcalc&#39;</span><span class="p">,</span> <span class="s1">&#39;setType&#39;</span><span class="p">,</span> <span class="s1">&#39;calibrate&#39;</span><span class="p">,</span> <span class="s1">&#39;LPfilter&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;interpolate&#39;</span><span class="p">,</span> <span class="s1">&#39;cropInterval&#39;</span><span class="p">,</span> <span class="s1">&#39;insertPeak&#39;</span><span class="p">,</span> <span class="s1">&#39;removePeak&#39;</span><span class="p">,</span> <span class="s1">&#39;SIGsave&#39;</span><span class="p">,</span> <span class="s1">&#39;B2Bsave&#39;</span><span class="p">,</span> <span class="s1">&#39;B2B_LPfilter&#39;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Operation </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s1"> not recognized. Exiting...&#39;</span> <span class="o">%</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;setType&#39;</span><span class="p">:</span>
                <span class="n">typeSignal</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="n">channel</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Setting Type channel=</span><span class="si">%d</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">typeSignal</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">typeSignal</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
                    <span class="n">typeSignal</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="n">typeSignal</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;setLabel&#39;</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="n">channel</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Setting Label channel=</span><span class="si">%d</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">label</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">setLabel</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;setUnit&#39;</span><span class="p">:</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="n">channel</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Setting Unit channel=</span><span class="si">%d</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">unit</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">setUnit</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;resample&#39;</span><span class="p">:</span>
                <span class="n">sampleRate</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;sampleRate&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
                <span class="n">method</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="n">channel</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Resampling channel=</span><span class="si">%d</span><span class="s1">: Fs= </span><span class="si">%f</span><span class="s1">, method=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">sampleRate</span><span class="p">,</span> <span class="n">method</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">sampleRate</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;calibrate&#39;</span><span class="p">:</span>
                <span class="n">valMin</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;valMin&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
                <span class="n">valMax</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;valMax&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
                <span class="n">method</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="n">segmentIdx</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;segmentIndexes&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;list_int&#39;</span><span class="p">)</span>
                <span class="n">channel</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calibrating channel= </span><span class="si">%d</span><span class="s1">: method= </span><span class="si">%s</span><span class="s1">, valMin=</span><span class="si">%f</span><span class="s1">, valMax=</span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">valMin</span><span class="p">,</span> <span class="n">valMax</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">calibrate</span><span class="p">(</span><span class="n">valMax</span><span class="p">,</span> <span class="n">valMin</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">segmentIdx</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;synchronize&#39;</span><span class="p">:</span>
                <span class="n">method</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;correlation&#39;</span><span class="p">:</span>
                    <span class="n">channelList</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;channels&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;list_int&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Synchronizing Channels </span><span class="si">%s</span><span class="s1">: method=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">channelList</span><span class="p">),</span> <span class="n">method</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">synchronizeSignals</span><span class="p">(</span><span class="n">channelList</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">ABPdelay_s</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;fixedAPB&#39;</span><span class="p">:</span>
                    <span class="n">ABPdelay_s</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;ABPdelay_s&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Synchronizing ABP channel: method=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">method</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">synchronizeSignals</span><span class="p">([],</span> <span class="n">method</span><span class="p">,</span> <span class="n">ABPdelay_s</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;LPfilter&#39;</span><span class="p">:</span>
                <span class="n">method</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="n">channel</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;movingAverage&#39;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;median&#39;</span><span class="p">:</span>
                    <span class="n">Ntaps</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;Ntaps&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Low Pass filter channel=</span><span class="si">%d</span><span class="s1">: method=</span><span class="si">%s</span><span class="s1">, Ntaps=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">Ntaps</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">LPfilter</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">nTaps</span><span class="o">=</span><span class="n">Ntaps</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;butterworth&#39;</span><span class="p">:</span>
                    <span class="n">order</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Low Pass filter channel=</span><span class="si">%d</span><span class="s1">: method=</span><span class="si">%s</span><span class="s1">, Ntaps=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">Ntaps</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">LPfilter</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">nTaps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;interpolate&#39;</span><span class="p">:</span>
                <span class="n">frameStart</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;frameStart&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="n">frameEnd</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;frameEnd&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="n">method</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="n">channel</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Interpolating channel=</span><span class="si">%d</span><span class="s1">: start=</span><span class="si">%d</span><span class="s1">, end=</span><span class="si">%d</span><span class="s1">, method=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">frameStart</span><span class="p">,</span> <span class="n">frameEnd</span><span class="p">,</span> <span class="n">method</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">frameStart</span><span class="p">,</span> <span class="n">frameEnd</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;cropInterval&#39;</span><span class="p">:</span>
                <span class="n">frameStart</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;frameStart&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="n">frameEnd</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;frameEnd&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="n">RemoveSegment</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;RemoveSegment&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;bool&#39;</span><span class="p">)</span>
                <span class="n">segmentIndexes</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;segmentIndexes&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;list_int&#39;</span><span class="p">)</span>
                <span class="n">channel</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cropping channel </span><span class="si">%s</span><span class="s1">: start=</span><span class="si">%d</span><span class="s1">, end=</span><span class="si">%d</span><span class="s1">, removeSegment=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">frameStart</span><span class="p">,</span> <span class="n">frameEnd</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">RemoveSegment</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">cropInterval</span><span class="p">(</span><span class="n">frameStart</span><span class="p">,</span> <span class="n">frameEnd</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">RemoveSegment</span><span class="p">,</span> <span class="n">segmentIndexes</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;findRRmarks&#39;</span><span class="p">:</span>
                <span class="n">refChannel</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;refChannel&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="n">method</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="n">findPeaks</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;findPeaks&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;bool&#39;</span><span class="p">)</span>
                <span class="n">findValleys</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;findValleys&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;bool&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Finding RRmarks: refChannel=</span><span class="si">%d</span><span class="s1"> method=</span><span class="si">%s</span><span class="s1"> findPeaks=</span><span class="si">%s</span><span class="s1"> findValleys=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">refChannel</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">findPeaks</span><span class="p">,</span> <span class="n">findValleys</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">findRRmarks</span><span class="p">(</span><span class="n">refChannel</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">findPeaks</span><span class="p">,</span> <span class="n">findValleys</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;insertPeak&#39;</span><span class="p">:</span>
                <span class="n">newIdx</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;newIdx&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="n">isPeak</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;isPeak&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;bool&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Inserting Peak: newIdx=</span><span class="si">%d</span><span class="s1">, isPeak=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newIdx</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">isPeak</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">insertPeak</span><span class="p">(</span><span class="n">newIdx</span><span class="p">,</span> <span class="n">isPeak</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;removePeak&#39;</span><span class="p">:</span>
                <span class="n">Idx</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;Idx&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="n">isPeak</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;isPeak&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;bool&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Removing Peak: Idx=</span><span class="si">%d</span><span class="s1">, isPeak=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Idx</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">isPeak</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">removePeak</span><span class="p">(</span><span class="n">Idx</span><span class="p">,</span> <span class="n">isPeak</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;SIGsave&#39;</span><span class="p">:</span>
                <span class="n">channelList</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;channels&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;list_int&#39;</span><span class="p">)</span>
                <span class="nb">format</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="n">fileName</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;fileName&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SIGsave: Channels</span><span class="si">%s</span><span class="s1"> filename=</span><span class="si">%s</span><span class="s1"> format=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">channelList</span><span class="p">),</span> <span class="n">fileName</span><span class="p">,</span> <span class="nb">format</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">saveSIG</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirName</span> <span class="o">+</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">channelList</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;B2Bcalc&#39;</span><span class="p">:</span>
                <span class="n">resampleMethod</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;resampleMethod&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="n">resampleRate_Hz</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;resampleRate_Hz&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Extracting beat-to-beat data: resampleMethod=</span><span class="si">%s</span><span class="s1">, Freq=</span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">resampleMethod</span><span class="p">,</span> <span class="n">resampleRate_Hz</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getBeat2beat</span><span class="p">(</span><span class="n">resampleRate_Hz</span><span class="p">,</span> <span class="n">resampleMethod</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;B2Bsave&#39;</span><span class="p">:</span>
                <span class="n">channelList</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;channels&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;list_int&#39;</span><span class="p">)</span>
                <span class="nb">format</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="n">fileName</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;fileName&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;B2Bsave: Channels</span><span class="si">%s</span><span class="s1"> filename=</span><span class="si">%s</span><span class="s1"> format=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">channelList</span><span class="p">),</span> <span class="n">fileName</span><span class="p">,</span> <span class="nb">format</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">saveB2B</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirName</span> <span class="o">+</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">channelList</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;B2B_LPfilter&#39;</span><span class="p">:</span>
                <span class="n">method</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="n">Ntaps</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;Ntaps&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;B2B LP filter: method=</span><span class="si">%s</span><span class="s1">, Ntaps=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">Ntaps</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LPfilterBeat2beat</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">Ntaps</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="patientData.runARanalysisOperations"><a class="viewcode-back" href="../index.html#patientData.patientData.runARanalysisOperations">[docs]</a>    <span class="k">def</span> <span class="nf">runARanalysisOperations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operationsElem</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Apply the operations previously loaded.</span>

<span class="sd">            **Note**</span>

<span class="sd">            This function os automatically called during the initialization  :meth:`__init__` if the input is a **.PPO** file.</span>

<span class="sd">            &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">operation</span> <span class="ow">in</span> <span class="n">operationsElem</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;PSDwelch&#39;</span><span class="p">,</span> <span class="s1">&#39;PSDsave&#39;</span><span class="p">,</span> <span class="s1">&#39;TFA&#39;</span><span class="p">,</span> <span class="s1">&#39;TFAsave&#39;</span><span class="p">,</span> <span class="s1">&#39;TFAsaveStat&#39;</span><span class="p">,</span> <span class="s1">&#39;ARI&#39;</span><span class="p">,</span> <span class="s1">&#39;ARIsave&#39;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Operation </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s1"> not recognized. Exiting...&#39;</span> <span class="o">%</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;PSDwelch&#39;</span><span class="p">:</span>
                <span class="n">useB2B</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;useB2B&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;bool&#39;</span><span class="p">)</span>
                <span class="n">overlap</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;overlap&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
                <span class="n">segmentLength_s</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;segmentLength_s&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
                <span class="n">windowType</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;windowType&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="n">detrend</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;detrend&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;bool&#39;</span><span class="p">)</span>
                <span class="n">filterType</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;filterType&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="n">nTapsFilter</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;nTapsFilter&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Computing PSDwelch: useB2B=</span><span class="si">%s</span><span class="s1"> overlap=</span><span class="si">%f</span><span class="s1"> segmentLength_s=</span><span class="si">%f</span><span class="s1"> windowType=</span><span class="si">%s</span><span class="s1"> detrend=</span><span class="si">%s</span><span class="s1"> filterType=</span><span class="si">%s</span><span class="s1">  nTapsFilter=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">useB2B</span><span class="p">),</span> <span class="n">overlap</span><span class="p">,</span> <span class="n">segmentLength_s</span><span class="p">,</span> <span class="n">windowType</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">detrend</span><span class="p">),</span> <span class="n">filterType</span><span class="p">,</span> <span class="n">nTapsFilter</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">computePSDwelch</span><span class="p">(</span><span class="n">useB2B</span><span class="p">,</span> <span class="n">overlap</span><span class="p">,</span> <span class="n">segmentLength_s</span><span class="p">,</span> <span class="n">windowType</span><span class="p">,</span> <span class="n">detrend</span><span class="p">,</span> <span class="n">filterType</span><span class="p">,</span> <span class="n">nTapsFilter</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;PSDsave&#39;</span><span class="p">:</span>
                <span class="n">fileName</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;fileName&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="nb">format</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="n">freqRange</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;freqRange&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PSDsave: freqRange</span><span class="si">%s</span><span class="s1"> filename=</span><span class="si">%s</span><span class="s1"> format=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">freqRange</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="nb">format</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">savePSD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirName</span> <span class="o">+</span> <span class="n">fileName</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">freqRange</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;TFA&#39;</span><span class="p">:</span>
                <span class="n">estimatorType</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;estimatorType&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;TFA: estimatorType=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">estimatorType</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">computeTFA</span><span class="p">(</span><span class="n">estimatorType</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;TFAsave&#39;</span><span class="p">:</span>
                <span class="n">fileName</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;fileName&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="nb">format</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="n">freqRange</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;freqRange&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;TFAsave: format=</span><span class="si">%s</span><span class="s1"> freqRange=</span><span class="si">%s</span><span class="s1"> fileName=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">format</span><span class="p">,</span> <span class="n">freqRange</span><span class="p">,</span> <span class="n">fileName</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">saveTF</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirName</span> <span class="o">+</span> <span class="n">fileName</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">freqRange</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;TFAsaveStat&#39;</span><span class="p">:</span>
                <span class="n">fileName</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;fileName&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="n">plotFileFormat</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;plotFileFormat&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="n">remNegPhase</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;remNegPhase&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;bool&#39;</span><span class="p">)</span>
                <span class="n">coheTreshold</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;coheTreshold&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;bool&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;TFAsaveStat: remNegPhase=</span><span class="si">%s</span><span class="s1"> coheTreshold=</span><span class="si">%s</span><span class="s1"> fileName=</span><span class="si">%s</span><span class="s1">  plotFileFormat=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">remNegPhase</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">coheTreshold</span><span class="p">),</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">plotFileFormat</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">plotFileFormat</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                    <span class="n">plotFileFormat</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">saveTFAstatistics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirName</span> <span class="o">+</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">plotFileFormat</span><span class="p">,</span> <span class="n">coheTreshold</span><span class="p">,</span> <span class="n">remNegPhase</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;ARI&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ARI:&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">computeARI</span><span class="p">(</span><span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">operation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;ARIsave&#39;</span><span class="p">:</span>
                <span class="n">fileName</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;fileName&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="n">plotFileFormat</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;plotFileFormat&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="nb">format</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getElemValueXpath</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="n">valType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ARIsave: format=</span><span class="si">%s</span><span class="s1"> fileName=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">format</span><span class="p">,</span> <span class="n">fileName</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">plotFileFormat</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                    <span class="n">plotFileFormat</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">saveARI</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirName</span> <span class="o">+</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">plotFileFormat</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="patientData.findChannel"><a class="viewcode-back" href="../index.html#patientData.patientData.findChannel">[docs]</a>    <span class="k">def</span> <span class="nf">findChannel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get channel number given its identifier of an attribute</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        attribute : string {&#39;label&#39;, &#39;type&#39;}</span>
<span class="sd">            Attribute under consideration</span>

<span class="sd">        identifier: string</span>
<span class="sd">            Identifier of the channel</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        index : int or None.</span>
<span class="sd">            Index of the channel or `None` in case of failure.</span>


<span class="sd">        **Example**</span>

<span class="sd">        &gt;&gt;&gt; from patientData import patientData as pD</span>
<span class="sd">        &gt;&gt;&gt; myCase=pD(&#39;data.EXP&#39;)</span>
<span class="sd">        &gt;&gt;&gt; myCase.loadData()</span>
<span class="sd">        &gt;&gt;&gt; print(myCase.listChannels(&#39;label&#39;))</span>
<span class="sd">        [&#39;MCA_L_To_Probe_Env&#39;, &#39;MCA_R_To_Probe_Env&#39;, &#39;Analog_1&#39;, &#39;Analog_8&#39;]</span>
<span class="sd">        &gt;&gt;&gt; print(myCase.findChannel(&#39;label&#39;,&#39;Analog_1&#39;))</span>
<span class="sd">        2</span>
<span class="sd">        &gt;&gt;&gt; print(myCase.findChannel(&#39;label&#39;,&#39;Analog_2&#39;))</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">listChannels</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="patientData.listChannels"><a class="viewcode-back" href="../index.html#patientData.patientData.listChannels">[docs]</a>    <span class="k">def</span> <span class="nf">listChannels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of values of the attribute from all channels</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        attribute : string {&#39;label&#39;, &#39;type&#39;}</span>
<span class="sd">            Attribute under consideration</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        attrs : list</span>
<span class="sd">            list containing the values of the attributes</span>


<span class="sd">        **Example**</span>

<span class="sd">        &gt;&gt;&gt; from patientData import patientData as pD</span>
<span class="sd">        &gt;&gt;&gt; myCase=pD(&#39;data.EXP&#39;)</span>
<span class="sd">        &gt;&gt;&gt; myCase.loadData()</span>
<span class="sd">        &gt;&gt;&gt; print(myCase.listChannels(&#39;label&#39;))</span>
<span class="sd">        [&#39;MCA_L_To_Probe_Env&#39;, &#39;MCA_R_To_Probe_Env&#39;, &#39;Analog_1&#39;, &#39;Analog_8&#39;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">attribute</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">attribute</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">sigType</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">]</span></div>

<div class="viewcode-block" id="patientData.findRRmarks"><a class="viewcode-back" href="../index.html#patientData.patientData.findRRmarks">[docs]</a>    <span class="k">def</span> <span class="nf">findRRmarks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">refChannel</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ampd&#39;</span><span class="p">,</span> <span class="n">findPeaks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">findValleys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find RR mark locations, given a reference signal.</span>

<span class="sd">        This function detect RR intervals, given a channel used as reference. The marks are detected by looking for its local maxima and/or minima. RR marks locations, in samples, are stored in :attr:`peakIdx` and/or `valleyIdx` respectively.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        refChannel : int</span>
<span class="sd">            Channel number of the signal used as reference</span>

<span class="sd">        method : string  {&#39;ampd&#39;, &#39;md&#39;}</span>
<span class="sd">            peak detection algorithm. Default: &#39;ampd&#39;</span>
<span class="sd">            * AMPD: Automatic Multiscale Peak Detection (AMPD) by Felix Scholkmann et al., 2012 &lt;https://github.com/LucaCerina/ampdLib&gt;</span>
<span class="sd">            * MD: Based on Marco Duarte&#39;s implementation &lt;https://github.com/demotu/BMC/blob/master/notebooks/DetectPeaks.ipynb&gt;</span>

<span class="sd">        findPeaks : bool, optional</span>
<span class="sd">            Detect local maxima of the signal. Default: True</span>

<span class="sd">        findValleys : bool, optional</span>
<span class="sd">            Detect local minima of the signal. Default: False</span>

<span class="sd">        register : bool, optional</span>
<span class="sd">            include this operation in the list of preprocessing operations. If False then the operation will not be stored.</span>


<span class="sd">        **Notes**</span>

<span class="sd">        * This function calls :meth:`~signals.signal.findPeaks` from each instance of :class:`~signals.signal` in the list of channels.</span>

<span class="sd">        **Example**</span>

<span class="sd">        &gt;&gt;&gt; from patientData import patientData as pD</span>
<span class="sd">        &gt;&gt;&gt; myCase=pD(&#39;data.EXP&#39;)</span>
<span class="sd">        &gt;&gt;&gt; myCase.loadData()</span>
<span class="sd">        &gt;&gt;&gt; myCase.findRRmarks(refChannel=0,method=&#39;ampd&#39;,findPeaks=True,findValleys=False,register=False) # find local maxima using channel 0 as reference. Does not register the operation</span>
<span class="sd">        &gt;&gt;&gt; myCase.removeRRmarks()  # remove RRmark information</span>
<span class="sd">        &gt;&gt;&gt; myCase.findRRmarks(refChannel=2,method=&#39;ampd&#39;,findPeaks=True,findValleys=True,register=True) # find local maxima and minima using channel 2 as reference. Register the operation</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">peakIdx</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valleyIdx</span><span class="p">,</span> <span class="n">_</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">refChannel</span><span class="p">]</span><span class="o">.</span><span class="n">findPeaks</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">findPeaks</span><span class="p">,</span> <span class="n">findValleys</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hasRRmarks</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># register operation</span>
        <span class="k">if</span> <span class="n">register</span><span class="p">:</span>
            <span class="n">xmlElement</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;findRRmarks&#39;</span><span class="p">)</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;refChannel&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">refChannel</span><span class="p">))</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;findPeaks&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">findPeaks</span><span class="p">))</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;findValleys&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">findValleys</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PPoperationsNode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmlElement</span><span class="p">)</span></div>

<div class="viewcode-block" id="patientData.insertPeak"><a class="viewcode-back" href="../index.html#patientData.patientData.insertPeak">[docs]</a>    <span class="k">def</span> <span class="nf">insertPeak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newIdx</span><span class="p">,</span> <span class="n">isPeak</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert extra peak/valley mark</span>

<span class="sd">        This function is used to insert a new RR mark to the list of peaks/valleys</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        newIdx : int</span>
<span class="sd">            indice of the new peak/valley</span>

<span class="sd">        isPeak : bool, optional</span>
<span class="sd">            Register the new index as a peak if True (default) or valley if False.</span>

<span class="sd">        register : bool, optional</span>
<span class="sd">            include this operation in the list of preprocessing operations. If False then the operation will not be stored.</span>


<span class="sd">        **Notes**</span>

<span class="sd">        * If a peak is already registered at the given `newIdx`, no peak is added and the function ends without any error or warning messages.</span>
<span class="sd">        **Example**</span>

<span class="sd">        &gt;&gt;&gt; from patientData import patientData as pD</span>
<span class="sd">        &gt;&gt;&gt; myCase=pD(&#39;data.EXP&#39;)</span>
<span class="sd">        &gt;&gt;&gt; myCase.loadData()</span>
<span class="sd">        &gt;&gt;&gt; myCase.findRRmarks(refChannel=2,method=&#39;ampd&#39;,findPeaks=True,findValleys=True,register=True)</span>
<span class="sd">        &gt;&gt;&gt; myCase.insertPeak(1200,isPeak=True,register=True) # add a peak at 1200</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasRRmarks</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">isPeak</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peakIdx</span><span class="p">,</span> <span class="n">newIdx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">peakIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peakIdx</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">newIdx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">peakIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peakIdx</span><span class="p">)</span>  <span class="c1"># removes eventual repeated indexes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valleyIdx</span><span class="p">,</span> <span class="n">newIdx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valleyIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valleyIdx</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">newIdx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valleyIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valleyIdx</span><span class="p">)</span>  <span class="c1"># removes eventual repeated indexes</span>

        <span class="c1"># register operation</span>
        <span class="k">if</span> <span class="n">register</span><span class="p">:</span>
            <span class="n">xmlElement</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;insertPeak&#39;</span><span class="p">)</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;newIdx&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">newIdx</span><span class="p">))</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;isPeak&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">isPeak</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PPoperationsNode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmlElement</span><span class="p">)</span></div>

<div class="viewcode-block" id="patientData.removePeak"><a class="viewcode-back" href="../index.html#patientData.patientData.removePeak">[docs]</a>    <span class="k">def</span> <span class="nf">removePeak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Idx</span><span class="p">,</span> <span class="n">isPeak</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a peak/valley mark</span>

<span class="sd">        This function is used to remove RR marks from the list of peaks/valleys</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Idx : int</span>
<span class="sd">            indice of the peak/valley to be removed</span>

<span class="sd">        isPeak : bool, optional</span>
<span class="sd">            Removes a peak if True (default) or valley if False.</span>

<span class="sd">        register : bool, optional</span>
<span class="sd">            include this operation in the list of preprocessing operations. If False then the operation will not be stored.</span>


<span class="sd">        **Note**</span>
<span class="sd">        * If a peak is not registered at the given `Idx`, no peak is removed and the function ends without any error or warning messages.</span>


<span class="sd">        **Example**</span>

<span class="sd">        &gt;&gt;&gt; from patientData import patientData as pD</span>
<span class="sd">        &gt;&gt;&gt; myCase=pD(&#39;data.EXP&#39;)</span>
<span class="sd">        &gt;&gt;&gt; myCase.loadData()</span>
<span class="sd">        &gt;&gt;&gt; myCase.findRRmarks(refChannel=2,method=&#39;ampd&#39;,findPeaks=True,findValleys=True,register=True)</span>
<span class="sd">        &gt;&gt;&gt; myCase.insertPeak(1200,isPeak=True,register=True) # add a peak at 1200</span>
<span class="sd">        &gt;&gt;&gt; myCase.removePeak(1200,isPeak=True,register=True) # remove the peak at 1200</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasRRmarks</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">isPeak</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peakIdx</span><span class="p">,</span> <span class="n">Idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">pos</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peakIdx</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">peakIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peakIdx</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Idx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">peakIdx</span><span class="p">[</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Idx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">peakIdx</span><span class="p">[</span><span class="n">pos</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">peakIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peakIdx</span><span class="p">,</span> <span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">peakIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peakIdx</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peakIdx</span><span class="p">,</span> <span class="n">Idx</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">pos</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valleyIdx</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">valleyIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valleyIdx</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Idx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">valleyIdx</span><span class="p">[</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Idx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">valleyIdx</span><span class="p">[</span><span class="n">pos</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">valleyIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valleyIdx</span><span class="p">,</span> <span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">valleyIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valleyIdx</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>

        <span class="c1"># register operation</span>
        <span class="k">if</span> <span class="n">register</span><span class="p">:</span>
            <span class="n">xmlElement</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;removePeak&#39;</span><span class="p">)</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;Idx&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Idx</span><span class="p">))</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;isPeak&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">isPeak</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PPoperationsNode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmlElement</span><span class="p">)</span></div>

<div class="viewcode-block" id="patientData.removeRRmarks"><a class="viewcode-back" href="../index.html#patientData.patientData.removeRRmarks">[docs]</a>    <span class="k">def</span> <span class="nf">removeRRmarks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        cleanup RR interval information</span>

<span class="sd">        **Example**</span>

<span class="sd">        &gt;&gt;&gt; from patientData import patientData as pD</span>
<span class="sd">        &gt;&gt;&gt; myCase=pD(&#39;data.EXP&#39;)</span>
<span class="sd">        &gt;&gt;&gt; myCase.loadData()</span>
<span class="sd">        &gt;&gt;&gt; myCase.findRRmarks(refChannel=0,method=&#39;ampd&#39;,findPeaks=True,findValleys=False,register=False)</span>
<span class="sd">        &gt;&gt;&gt; myCase.removeRRmarks()  # remove RRmark information</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasRRmarks</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">peakIdx</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">valleyIdx</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hasRRmarks</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="patientData.synchronizeSignals"><a class="viewcode-back" href="../index.html#patientData.patientData.synchronizeSignals">[docs]</a>    <span class="k">def</span> <span class="nf">synchronizeSignals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channelList</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;correlation&#39;</span><span class="p">,</span> <span class="n">ABPdelay_s</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Synchronize the channels</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        channelList : list of integers</span>
<span class="sd">            List of channels to synchronize. This argument is used only when method=&#39;correlation&#39;</span>

<span class="sd">        method : string  {&#39;correlation&#39;, &#39;fixedAPB&#39;}</span>
<span class="sd">            synchronization method. Default: &#39;correlation&#39;</span>

<span class="sd">            * fixedAPB: Based on Marco Duarte&#39;s implementation &lt;https://github.com/demotu/BMC/blob/master/notebooks/DetectPeaks.ipynb&gt;</span>

<span class="sd">        ABPdelay_s : float</span>
<span class="sd">            Arterial blood pressure fxed delay in seconds. This argument is used only when method=&#39;fixedAPB&#39;.</span>

<span class="sd">        register : bool, optional</span>
<span class="sd">            include this operation in the list of preprocessing operations. If False then the operation will not be stored.</span>


<span class="sd">        **Algorithms**</span>

<span class="sd">        * Correlation: synchronization is based on the correlation between the channels. For each two channels, the delay is define by the index of the peak in correlation between the channels.</span>

<span class="sd">        * fixedABP: Only the arterial blood pressure (ABP) channel is delayed. The argument `ABPdelay_s` defines the delay, in seconds. This algorithms will look for the APB channel. See :meth:`~signals.signal.setType`.</span>


<span class="sd">        After the synchronization, each channel might be cropped on one or both sides to comply with the new timespan, defined by the time interval in common across all channels. See figure below.</span>

<span class="sd">        .. image:: ./images/sync.png</span>
<span class="sd">            :width: 900px</span>
<span class="sd">            :align: center</span>

<span class="sd">        **Example**</span>

<span class="sd">        &gt;&gt;&gt; from patientData import patientData as pD</span>
<span class="sd">        &gt;&gt;&gt; myCase=pD(&#39;data.EXP&#39;)</span>
<span class="sd">        &gt;&gt;&gt; myCase.loadData()</span>
<span class="sd">        &gt;&gt;&gt; myCase.synchronizeSignals(channelList=[0,1,2],method=&#39;correlation&#39;,ABPdelay_s=0.0,register=True) # synchronize channels 0, 1 and 2, using correlation method</span>
<span class="sd">        &gt;&gt;&gt; myCase.signals[2].setType(&#39;ABP&#39;)</span>
<span class="sd">        &gt;&gt;&gt; myCase.synchronizeSignals(channelList=None,method=&#39;fixedAPB&#39;,ABPdelay_s=0.2,register=True) # synchronize ABP channel, using the fixed delay method</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">removeRRmarks</span><span class="p">()</span>
        <span class="n">delays</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;correlation&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">channelList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="c1"># delays with respect to ABP channel</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">:</span>  <span class="c1"># finds ABP channel  # delay in samples</span>
                <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">sigType</span> <span class="o">==</span> <span class="s1">&#39;ABP&#39;</span><span class="p">:</span>
                    <span class="n">refChannel</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">channel</span>

            <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channelList</span><span class="p">:</span>
                <span class="c1"># based on:  https://stackoverflow.com/questions/4688715/find-time-shift-between-two-similar-waveforms</span>
                <span class="n">delaySamples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">scipySignal</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">refChannel</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span>
                  <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">refChannel</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delaySamples</span><span class="p">)</span>
            <span class="n">delays</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">delays</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">delays</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;fixedAPB&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">:</span>  <span class="c1"># finds ABP channel  # delay in samples</span>
                <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">sigType</span> <span class="o">==</span> <span class="s1">&#39;ABP&#39;</span><span class="p">:</span>
                    <span class="n">delaySamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ABPdelay_s</span> <span class="o">*</span> <span class="n">s</span><span class="o">.</span><span class="n">samplingRate_Hz</span><span class="p">)</span>
                    <span class="n">delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delaySamples</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ABPdelay_s</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">delays</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">-</span> <span class="n">delaySamples</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">delays</span><span class="p">]</span>
            <span class="n">channelList</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nChannels</span><span class="p">)</span>

        <span class="n">length</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">channelList</span><span class="p">)):</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="n">channelList</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span>
            <span class="n">delay</span> <span class="o">=</span> <span class="n">delays</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span>
            <span class="c1"># print(&#39;ch: %d   delay:%d&#39; %(channel,delay))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">cropFromLeft</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">length</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span><span class="o">.</span><span class="n">nPoints</span><span class="p">)</span>

        <span class="n">minLength</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nChannels</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">cropFromRight</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">nPoints</span> <span class="o">-</span> <span class="n">minLength</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># register operation</span>
        <span class="k">if</span> <span class="n">register</span><span class="p">:</span>
            <span class="n">xmlElement</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;synchronize&#39;</span><span class="p">)</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;correlation&#39;</span><span class="p">:</span>
                <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;channels&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">channelList</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;fixedAPB&#39;</span><span class="p">:</span>
                <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;ABPdelay_s&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">ABPdelay_s</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PPoperationsNode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmlElement</span><span class="p">)</span></div>

<div class="viewcode-block" id="patientData.getBeat2beat"><a class="viewcode-back" href="../index.html#patientData.patientData.getBeat2beat">[docs]</a>    <span class="k">def</span> <span class="nf">getBeat2beat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resampleRate_Hz</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">resampleMethod</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hasB2Bdata</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nChannels</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">beat2beat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peakIdx</span><span class="p">,</span> <span class="n">resampleRate_Hz</span><span class="p">,</span> <span class="n">resampleMethod</span><span class="p">)</span>  <span class="c1"># print(self.signals[ch].beat2beatData.max)</span>

        <span class="c1"># register operation</span>
        <span class="k">if</span> <span class="n">register</span><span class="p">:</span>
            <span class="n">xmlElement</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;B2Bcalc&#39;</span><span class="p">)</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;resampleMethod&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">resampleMethod</span><span class="p">)</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;resampleRate_Hz&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">resampleRate_Hz</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PPoperationsNode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmlElement</span><span class="p">)</span></div>

<div class="viewcode-block" id="patientData.removeBeat2beat"><a class="viewcode-back" href="../index.html#patientData.patientData.removeBeat2beat">[docs]</a>    <span class="k">def</span> <span class="nf">removeBeat2beat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasB2Bdata</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nChannels</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">beat2beatData</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hasB2Bdata</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="patientData.LPfilterBeat2beat"><a class="viewcode-back" href="../index.html#patientData.patientData.LPfilterBeat2beat">[docs]</a>    <span class="k">def</span> <span class="nf">LPfilterBeat2beat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;movvalueingAverage&#39;</span><span class="p">,</span> <span class="n">nTaps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasB2Bdata</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: B2Bdata not found...&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">beat2beatData</span><span class="o">.</span><span class="n">LPfilter</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">nTaps</span><span class="p">)</span>

        <span class="c1"># register operation</span>
        <span class="k">if</span> <span class="n">register</span><span class="p">:</span>
            <span class="n">xmlElement</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;B2B_LPfilter&#39;</span><span class="p">)</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">method</span><span class="p">))</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;Ntaps&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">nTaps</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PPoperationsNode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmlElement</span><span class="p">)</span></div>

    <span class="c1"># filterType: valid values: &#39;triangular&#39;, &#39;rect&#39;, None (no filter)</span>
<div class="viewcode-block" id="patientData.computePSDwelch"><a class="viewcode-back" href="../index.html#patientData.patientData.computePSDwelch">[docs]</a>    <span class="k">def</span> <span class="nf">computePSDwelch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">useB2B</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">segmentLength_s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">windowType</span><span class="o">=</span><span class="s1">&#39;hanning&#39;</span><span class="p">,</span> <span class="n">detrend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filterType</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">nTapsFilter</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                        <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># find ABP and CBFV channels</span>
        <span class="n">ABP_channel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">CBFv_R_channel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">CBFv_L_channel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">sigType</span> <span class="o">==</span> <span class="s1">&#39;ABP&#39;</span><span class="p">:</span>
                <span class="n">ABP_channel</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">channel</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">sigType</span> <span class="o">==</span> <span class="s1">&#39;CBFV_R&#39;</span><span class="p">:</span>
                <span class="n">CBFv_R_channel</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">channel</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">sigType</span> <span class="o">==</span> <span class="s1">&#39;CBFV_L&#39;</span><span class="p">:</span>
                <span class="n">CBFv_L_channel</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">channel</span>

        <span class="c1"># left side</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ABP_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">CBFv_L_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">useB2B</span><span class="p">:</span>
                <span class="n">inputSignal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ABP_channel</span><span class="p">]</span><span class="o">.</span><span class="n">beat2beatData</span><span class="o">.</span><span class="n">avg</span>
                <span class="n">outputSignal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">CBFv_L_channel</span><span class="p">]</span><span class="o">.</span><span class="n">beat2beatData</span><span class="o">.</span><span class="n">avg</span>
                <span class="n">Fs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ABP_channel</span><span class="p">]</span><span class="o">.</span><span class="n">beat2beatData</span><span class="o">.</span><span class="n">samplingRate_Hz</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">inputSignal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ABP_channel</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
                <span class="n">outputSignal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">CBFv_L_channel</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
                <span class="n">Fs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ABP_channel</span><span class="p">]</span><span class="o">.</span><span class="n">samplingRate_Hz</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">PSD_L</span> <span class="o">=</span> <span class="n">PSDestimator</span><span class="p">(</span><span class="n">inputSignal</span><span class="p">,</span> <span class="n">outputSignal</span><span class="p">,</span> <span class="n">Fs</span><span class="p">,</span> <span class="n">overlap</span><span class="p">,</span> <span class="n">segmentLength_s</span><span class="p">,</span> <span class="n">windowType</span><span class="p">,</span> <span class="n">detrend</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ABP_channel</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">CBFv_L_channel</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PSD_L</span><span class="o">.</span><span class="n">computeWelch</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hasPSDdata_L</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">filterType</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PSD_L</span><span class="o">.</span><span class="n">filterAll</span><span class="p">(</span><span class="n">filterType</span><span class="p">,</span> <span class="n">nTapsFilter</span><span class="p">,</span> <span class="n">keepFirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hasPSDdata_L</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># right channel</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ABP_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">CBFv_R_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">useB2B</span><span class="p">:</span>
                <span class="n">inputSignal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ABP_channel</span><span class="p">]</span><span class="o">.</span><span class="n">beat2beatData</span><span class="o">.</span><span class="n">avg</span>
                <span class="n">outputSignal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">CBFv_R_channel</span><span class="p">]</span><span class="o">.</span><span class="n">beat2beatData</span><span class="o">.</span><span class="n">avg</span>
                <span class="n">Fs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ABP_channel</span><span class="p">]</span><span class="o">.</span><span class="n">beat2beatData</span><span class="o">.</span><span class="n">samplingRate_Hz</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">inputSignal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ABP_channel</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
                <span class="n">outputSignal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">CBFv_R_channel</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
                <span class="n">Fs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ABP_channel</span><span class="p">]</span><span class="o">.</span><span class="n">samplingRate_Hz</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">PSD_R</span> <span class="o">=</span> <span class="n">PSDestimator</span><span class="p">(</span><span class="n">inputSignal</span><span class="p">,</span> <span class="n">outputSignal</span><span class="p">,</span> <span class="n">Fs</span><span class="p">,</span> <span class="n">overlap</span><span class="p">,</span> <span class="n">segmentLength_s</span><span class="p">,</span> <span class="n">windowType</span><span class="p">,</span> <span class="n">detrend</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">ABP_channel</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">CBFv_R_channel</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PSD_R</span><span class="o">.</span><span class="n">computeWelch</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hasPSDdata_R</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">filterType</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PSD_R</span><span class="o">.</span><span class="n">filterAll</span><span class="p">(</span><span class="n">filterType</span><span class="p">,</span> <span class="n">nTapsFilter</span><span class="p">,</span> <span class="n">keepFirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hasPSDdata_R</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">register</span><span class="p">:</span>
            <span class="n">xmlElement</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;PSDwelch&#39;</span><span class="p">)</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;useB2B&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">useB2B</span><span class="p">))</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;overlap&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">overlap</span><span class="p">))</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;segmentLength_s&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">segmentLength_s</span><span class="p">))</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;windowType&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">windowType</span><span class="p">)</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;detrend&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">detrend</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">filterType</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;filterType&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;filterType&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">filterType</span><span class="p">)</span>
                <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;nTapsFilter&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">nTapsFilter</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ARoperationsNode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmlElement</span><span class="p">)</span></div>

    <span class="c1"># fileName: file with .psd extension</span>
<div class="viewcode-block" id="patientData.savePSD"><a class="viewcode-back" href="../index.html#patientData.patientData.savePSD">[docs]</a>    <span class="k">def</span> <span class="nf">savePSD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filePath</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="n">freqRange</span><span class="o">=</span><span class="s1">&#39;ALL&#39;</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># freqRange (string)  &#39;VLF&#39;, &#39;LF&#39;, &#39;HF&#39;, &#39;ALL&#39; (default), &#39;FULL&#39;</span>
        <span class="c1"># format : string, optional</span>
        <span class="c1">#    File format. Avaiable values: &#39;csv&#39;, &#39;numpy&#39;, &#39;simple_text&#39;</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasPSDdata_L</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasPSDdata_R</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No power spectrum data was found. Canceling save...&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving power spectrum density data&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;simple_text&#39;</span><span class="p">:</span>
            <span class="n">outputFile</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">setFileExtension</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s1">&#39;.psd&#39;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasPSDdata_L</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasPSDdata_R</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PSD_L</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">writeMode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PSD_R</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">writeMode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasPSDdata_L</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PSD_L</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">writeMode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasPSDdata_R</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PSD_R</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">writeMode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">signals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasPSDdata_L</span><span class="p">:</span>
                <span class="n">freq_L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PSD_L</span><span class="o">.</span><span class="n">freqRangeExtractor</span><span class="o">.</span><span class="n">getFreq</span><span class="p">(</span><span class="n">freqRange</span><span class="p">)</span>
                <span class="n">nPoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_L</span><span class="p">)</span>
                <span class="n">Sxx_L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PSD_L</span><span class="o">.</span><span class="n">freqRangeExtractor</span><span class="o">.</span><span class="n">getSignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PSD_L</span><span class="o">.</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">freqRange</span><span class="p">)</span>
                <span class="n">Syy_L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PSD_L</span><span class="o">.</span><span class="n">freqRangeExtractor</span><span class="o">.</span><span class="n">getSignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PSD_L</span><span class="o">.</span><span class="n">Syy</span><span class="p">,</span> <span class="n">freqRange</span><span class="p">)</span>
                <span class="n">Sxy_L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PSD_L</span><span class="o">.</span><span class="n">freqRangeExtractor</span><span class="o">.</span><span class="n">getSignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PSD_L</span><span class="o">.</span><span class="n">Sxy</span><span class="p">,</span> <span class="n">freqRange</span><span class="p">)</span>
                <span class="n">Syx_L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PSD_L</span><span class="o">.</span><span class="n">freqRangeExtractor</span><span class="o">.</span><span class="n">getSignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PSD_L</span><span class="o">.</span><span class="n">Syx</span><span class="p">,</span> <span class="n">freqRange</span><span class="p">)</span>
                <span class="n">signals</span> <span class="o">+=</span> <span class="p">[</span><span class="n">freq_L</span><span class="p">,</span> <span class="n">Sxx_L</span><span class="p">,</span> <span class="n">Syy_L</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Sxy_L</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Sxy_L</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Syx_L</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Syx_L</span><span class="p">)]</span>
                <span class="n">header</span> <span class="o">+=</span> <span class="s1">&#39;freq (Hz);Sxx_L;Syy_L;Sxy_L (real part);Sxy_L (imag part);Syx_L (real part);Syx_L (imag part);&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasPSDdata_R</span><span class="p">:</span>
                <span class="n">freq_R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PSD_R</span><span class="o">.</span><span class="n">freqRangeExtractor</span><span class="o">.</span><span class="n">getFreq</span><span class="p">(</span><span class="n">freqRange</span><span class="p">)</span>
                <span class="n">nPoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_R</span><span class="p">)</span>
                <span class="n">Sxx_R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PSD_R</span><span class="o">.</span><span class="n">freqRangeExtractor</span><span class="o">.</span><span class="n">getSignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PSD_R</span><span class="o">.</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">freqRange</span><span class="p">)</span>
                <span class="n">Syy_R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PSD_R</span><span class="o">.</span><span class="n">freqRangeExtractor</span><span class="o">.</span><span class="n">getSignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PSD_R</span><span class="o">.</span><span class="n">Syy</span><span class="p">,</span> <span class="n">freqRange</span><span class="p">)</span>
                <span class="n">Sxy_R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PSD_R</span><span class="o">.</span><span class="n">freqRangeExtractor</span><span class="o">.</span><span class="n">getSignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PSD_R</span><span class="o">.</span><span class="n">Sxy</span><span class="p">,</span> <span class="n">freqRange</span><span class="p">)</span>
                <span class="n">Syx_R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PSD_R</span><span class="o">.</span><span class="n">freqRangeExtractor</span><span class="o">.</span><span class="n">getSignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PSD_R</span><span class="o">.</span><span class="n">Syx</span><span class="p">,</span> <span class="n">freqRange</span><span class="p">)</span>
                <span class="c1"># add frequency vector only if there is no left PSD data</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasPSDdata_L</span><span class="p">:</span>
                    <span class="n">signals</span> <span class="o">+=</span> <span class="p">[</span><span class="n">freq_R</span><span class="p">,</span> <span class="n">Sxx_R</span><span class="p">,</span> <span class="n">Syy_R</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Sxy_R</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Sxy_R</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Syx_R</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Syx_R</span><span class="p">)]</span>
                    <span class="n">header</span> <span class="o">+=</span> <span class="s1">&#39;freq (Hz);Sxx_R;Syy_R;Sxy_R (real part);Sxy_R (imag part);Syx_R (real part);Syx_R (imag part);&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">signals</span> <span class="o">+=</span> <span class="p">[</span><span class="n">Sxx_R</span><span class="p">,</span> <span class="n">Syy_R</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Sxy_R</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Sxy_R</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Syx_R</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Syx_R</span><span class="p">)]</span>
                    <span class="n">header</span> <span class="o">+=</span> <span class="s1">&#39;Sxx_R;Syy_R;Sxy_R (real part);Sxy_R (imag part);Syx_R (real part);Syx_R (imag part);&#39;</span>

            <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
                <span class="n">outputFile</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">setFileExtension</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fOut</span><span class="p">:</span>
                    <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;NPOINTS;</span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nPoints</span><span class="p">)</span>
                    <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;-------DATA START-------;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">signals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">signals</span><span class="p">))</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fOut</span><span class="p">,</span> <span class="n">signals</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.15e</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;-------DATA END-------;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;numpy&#39;</span><span class="p">:</span>
                <span class="n">outputFile</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">setFileExtension</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s1">&#39;.npy&#39;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>

                <span class="c1"># build a structured array</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasPSDdata_L</span><span class="p">:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">freq_L</span><span class="p">,</span> <span class="n">Sxx_L</span><span class="p">,</span> <span class="n">Syy_L</span><span class="p">,</span> <span class="n">Sxy_L</span><span class="p">,</span> <span class="n">Syx_L</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasPSDdata_R</span><span class="p">:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">freq_R</span><span class="p">,</span> <span class="n">Sxx_R</span><span class="p">,</span> <span class="n">Syy_R</span><span class="p">,</span> <span class="n">Sxy_R</span><span class="p">,</span> <span class="n">Syx_R</span><span class="p">))</span>

                <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span>
                  <span class="p">[(</span><span class="s1">&#39;side&#39;</span><span class="p">,</span> <span class="s1">&#39;U1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;freq_(Hz)&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="n">nPoints</span><span class="p">,)),</span> <span class="p">(</span><span class="s1">&#39;Sxx&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="n">nPoints</span><span class="p">,)),</span> <span class="p">(</span><span class="s1">&#39;Syy&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="n">nPoints</span><span class="p">,)),</span>
                   <span class="p">(</span><span class="s1">&#39;Sxy&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span> <span class="p">(</span><span class="n">nPoints</span><span class="p">,)),</span> <span class="p">(</span><span class="s1">&#39;Syx&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span> <span class="p">(</span><span class="n">nPoints</span><span class="p">,))])</span>

                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">register</span><span class="p">:</span>
            <span class="n">xmlElement</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;PSDsave&#39;</span><span class="p">)</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;fileName&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filePath</span><span class="p">))</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;freqRange&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">freqRange</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ARoperationsNode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmlElement</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ok!&#39;</span><span class="p">)</span></div>

    <span class="c1"># estimatorType:  &#39;H1&#39;   or &#39;H2&#39;</span>
<div class="viewcode-block" id="patientData.computeTFA"><a class="viewcode-back" href="../index.html#patientData.patientData.computeTFA">[docs]</a>    <span class="k">def</span> <span class="nf">computeTFA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimatorType</span><span class="o">=</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasPSDdata_L</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TFA_L</span> <span class="o">=</span> <span class="n">transferFunctionAnalysis</span><span class="p">(</span><span class="n">PSDdata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">PSD_L</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">estimatorType</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;H1&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TFA_L</span><span class="o">.</span><span class="n">computeH1</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">estimatorType</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;H2&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TFA_L</span><span class="o">.</span><span class="n">computeH2</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_L</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasPSDdata_R</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TFA_R</span> <span class="o">=</span> <span class="n">transferFunctionAnalysis</span><span class="p">(</span><span class="n">PSDdata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">PSD_R</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">estimatorType</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;H1&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TFA_R</span><span class="o">.</span><span class="n">computeH1</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">estimatorType</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;H2&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TFA_R</span><span class="o">.</span><span class="n">computeH2</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_R</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># self.TFA_R.savePlot(fileNamePrefix=None)</span>

        <span class="k">if</span> <span class="n">register</span><span class="p">:</span>
            <span class="n">xmlElement</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;TFA&#39;</span><span class="p">)</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;estimatorType&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">estimatorType</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ARoperationsNode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmlElement</span><span class="p">)</span></div>

    <span class="c1"># fileName: file with .tf extension</span>
<div class="viewcode-block" id="patientData.saveTF"><a class="viewcode-back" href="../index.html#patientData.patientData.saveTF">[docs]</a>    <span class="k">def</span> <span class="nf">saveTF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filePath</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="n">freqRange</span><span class="o">=</span><span class="s1">&#39;ALL&#39;</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># freqRange (string)  &#39;VLF&#39;, &#39;LF&#39;, &#39;HF&#39;, &#39;ALL&#39; (default), &#39;FULL&#39;</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_L</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_R</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No transfer function data was found. Canceling save...&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;simple_text&#39;</span><span class="p">:</span>
            <span class="n">outputFile</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">setFileExtension</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s1">&#39;.tf&#39;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_L</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_L</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TFA_L</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">freqRange</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">writeMode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TFA_R</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">freqRange</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">writeMode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_L</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">TFA_L</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">freqRange</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">writeMode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_L</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">TFA_R</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">freqRange</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">writeMode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">signals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_L</span><span class="p">:</span>
                <span class="n">freq_L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TFA_L</span><span class="o">.</span><span class="n">getFreq</span><span class="p">(</span><span class="n">freqRange</span><span class="p">)</span>
                <span class="n">nPoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_L</span><span class="p">)</span>
                <span class="n">H_L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TFA_L</span><span class="o">.</span><span class="n">getH</span><span class="p">(</span><span class="n">freqRange</span><span class="p">)</span>
                <span class="n">Gain_L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TFA_L</span><span class="o">.</span><span class="n">getGain</span><span class="p">(</span><span class="n">freqRange</span><span class="p">)</span>
                <span class="n">Phase_deg_L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TFA_L</span><span class="o">.</span><span class="n">getPhase</span><span class="p">(</span><span class="n">freqRange</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
                <span class="n">Coherence_L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TFA_L</span><span class="o">.</span><span class="n">getCoherence</span><span class="p">(</span><span class="n">freqRange</span><span class="p">)</span>
                <span class="n">signals</span> <span class="o">+=</span> <span class="p">[</span><span class="n">freq_L</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">H_L</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">H_L</span><span class="p">),</span> <span class="n">Gain_L</span><span class="p">,</span> <span class="n">Phase_deg_L</span><span class="p">,</span> <span class="n">Coherence_L</span><span class="p">]</span>
                <span class="n">header</span> <span class="o">+=</span> <span class="s1">&#39;freq (Hz);H_L (real part);H_L (imag part);Gain_L;Phase_deg_L;Coherence_L;&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_R</span><span class="p">:</span>
                <span class="n">freq_R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TFA_R</span><span class="o">.</span><span class="n">getFreq</span><span class="p">(</span><span class="n">freqRange</span><span class="p">)</span>
                <span class="n">nPoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_R</span><span class="p">)</span>
                <span class="n">H_R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TFA_R</span><span class="o">.</span><span class="n">getH</span><span class="p">(</span><span class="n">freqRange</span><span class="p">)</span>
                <span class="n">Gain_R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TFA_R</span><span class="o">.</span><span class="n">getGain</span><span class="p">(</span><span class="n">freqRange</span><span class="p">)</span>
                <span class="n">Phase_deg_R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TFA_R</span><span class="o">.</span><span class="n">getPhase</span><span class="p">(</span><span class="n">freqRange</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
                <span class="n">Coherence_R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TFA_R</span><span class="o">.</span><span class="n">getCoherence</span><span class="p">(</span><span class="n">freqRange</span><span class="p">)</span>
                <span class="c1"># add frequency vector only if there is no left PSD data</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_L</span><span class="p">:</span>
                    <span class="n">signals</span> <span class="o">+=</span> <span class="p">[</span><span class="n">freq_R</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">H_R</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">H_R</span><span class="p">),</span> <span class="n">Gain_R</span><span class="p">,</span> <span class="n">Phase_deg_R</span><span class="p">,</span> <span class="n">Coherence_R</span><span class="p">]</span>
                    <span class="n">header</span> <span class="o">+=</span> <span class="s1">&#39;freq (Hz);H_R (real part);H_R (imag part);Gain_R;Phase_deg_R;Coherence_R;&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">signals</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">H_R</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">H_R</span><span class="p">),</span> <span class="n">Gain_R</span><span class="p">,</span> <span class="n">Phase_deg_R</span><span class="p">,</span> <span class="n">Coherence_R</span><span class="p">]</span>
                    <span class="n">header</span> <span class="o">+=</span> <span class="s1">&#39;H_R (real part);H_R (imag part);Gain_R;Phase_deg_R;Coherence_R;&#39;</span>

            <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
                <span class="n">outputFile</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">setFileExtension</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fOut</span><span class="p">:</span>
                    <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;NPOINTS;</span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nPoints</span><span class="p">)</span>
                    <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;-------DATA START-------;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">signals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">signals</span><span class="p">))</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fOut</span><span class="p">,</span> <span class="n">signals</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.15e</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;-------DATA END-------;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;numpy&#39;</span><span class="p">:</span>
                <span class="n">outputFile</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">setFileExtension</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s1">&#39;.npy&#39;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>

                <span class="c1"># build a structured array</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_L</span><span class="p">:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">freq_L</span><span class="p">,</span> <span class="n">H_L</span><span class="p">,</span> <span class="n">Gain_L</span><span class="p">,</span> <span class="n">Phase_deg_L</span><span class="p">,</span> <span class="n">Coherence_L</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_L</span><span class="p">:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">freq_R</span><span class="p">,</span> <span class="n">H_R</span><span class="p">,</span> <span class="n">Gain_R</span><span class="p">,</span> <span class="n">Phase_deg_R</span><span class="p">,</span> <span class="n">Coherence_R</span><span class="p">))</span>

                <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span>
                  <span class="p">[(</span><span class="s1">&#39;side&#39;</span><span class="p">,</span> <span class="s1">&#39;U1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;freq_(Hz)&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="n">nPoints</span><span class="p">,)),</span> <span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span> <span class="p">(</span><span class="n">nPoints</span><span class="p">,)),</span> <span class="p">(</span><span class="s1">&#39;gain&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="n">nPoints</span><span class="p">,)),</span>
                   <span class="p">(</span><span class="s1">&#39;phase_(deg)&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="n">nPoints</span><span class="p">,)),</span> <span class="p">(</span><span class="s1">&#39;coherence&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="n">nPoints</span><span class="p">,))])</span>

                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">register</span><span class="p">:</span>
            <span class="n">xmlElement</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;TFAsave&#39;</span><span class="p">)</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;fileName&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filePath</span><span class="p">))</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;freqRange&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">freqRange</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ARoperationsNode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmlElement</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ok!&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="patientData.saveTFAstatistics"><a class="viewcode-back" href="../index.html#patientData.patientData.saveTFAstatistics">[docs]</a>    <span class="k">def</span> <span class="nf">saveTFAstatistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filePath</span><span class="p">,</span> <span class="n">plotFileFormat</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">coheTreshold</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">remNegPhase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># plotFileFormat: valid formats:</span>

        <span class="k">if</span> <span class="n">plotFileFormat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plotFileFormat</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="s1">&#39;jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;tif&#39;</span><span class="p">,</span> <span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="s1">&#39;eps&#39;</span><span class="p">,</span> <span class="s1">&#39;ps&#39;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;TFA Plot file format </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s1"> not recognized. Exiting...&#39;</span> <span class="o">%</span> <span class="n">plotFileFormat</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_L</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_R</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No transfer function data was found. Canceling save...&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">outputFile</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">setFileExtension</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s1">&#39;.tfa&#39;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_L</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_R</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TFA_L</span><span class="o">.</span><span class="n">saveStatistics</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">coheTreshold</span><span class="p">,</span> <span class="n">remNegPhase</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TFA_R</span><span class="o">.</span><span class="n">saveStatistics</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">coheTreshold</span><span class="p">,</span> <span class="n">remNegPhase</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_L</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TFA_L</span><span class="o">.</span><span class="n">saveStatistics</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">coheTreshold</span><span class="p">,</span> <span class="n">remNegPhase</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_R</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TFA_R</span><span class="o">.</span><span class="n">saveStatistics</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">coheTreshold</span><span class="p">,</span> <span class="n">remNegPhase</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plotFileFormat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_L</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TFA_L</span><span class="o">.</span><span class="n">savePlot</span><span class="p">(</span><span class="n">fileNamePrefix</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filePath</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_Left&#39;</span><span class="p">,</span> <span class="n">fileType</span><span class="o">=</span><span class="n">plotFileFormat</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">coheTreshold</span><span class="o">=</span><span class="n">coheTreshold</span><span class="p">,</span>
                                    <span class="n">remNegPhase</span><span class="o">=</span><span class="n">remNegPhase</span><span class="p">,</span> <span class="n">figDpi</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">fontSize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_R</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TFA_R</span><span class="o">.</span><span class="n">savePlot</span><span class="p">(</span><span class="n">fileNamePrefix</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filePath</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_Right&#39;</span><span class="p">,</span> <span class="n">fileType</span><span class="o">=</span><span class="n">plotFileFormat</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">coheTreshold</span><span class="o">=</span><span class="n">coheTreshold</span><span class="p">,</span>
                                    <span class="n">remNegPhase</span><span class="o">=</span><span class="n">remNegPhase</span><span class="p">,</span> <span class="n">figDpi</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">fontSize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">register</span><span class="p">:</span>
            <span class="n">xmlElement</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;TFAsaveStat&#39;</span><span class="p">)</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;fileName&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filePath</span><span class="p">))</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;plotFileFormat&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">plotFileFormat</span><span class="p">))</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;remNegPhase&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">remNegPhase</span><span class="p">))</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;coheTreshold&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">coheTreshold</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ARoperationsNode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmlElement</span><span class="p">)</span></div>

<div class="viewcode-block" id="patientData.computeARI"><a class="viewcode-back" href="../index.html#patientData.patientData.computeARI">[docs]</a>    <span class="k">def</span> <span class="nf">computeARI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_L</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ARI_L</span> <span class="o">=</span> <span class="n">ARIanalysis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TFA_L</span><span class="o">.</span><span class="n">H</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TFA_L</span><span class="o">.</span><span class="n">PSDdata</span><span class="o">.</span><span class="n">Ts</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">TFA_L</span><span class="o">.</span><span class="n">PSDdata</span><span class="o">.</span><span class="n">unitX</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">TFA_L</span><span class="o">.</span><span class="n">PSDdata</span><span class="o">.</span><span class="n">unitY</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hasARIdata_L</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasTFdata_R</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ARI_R</span> <span class="o">=</span> <span class="n">ARIanalysis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TFA_R</span><span class="o">.</span><span class="n">H</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TFA_R</span><span class="o">.</span><span class="n">PSDdata</span><span class="o">.</span><span class="n">Ts</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">TFA_R</span><span class="o">.</span><span class="n">PSDdata</span><span class="o">.</span><span class="n">unitX</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">TFA_R</span><span class="o">.</span><span class="n">PSDdata</span><span class="o">.</span><span class="n">unitY</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hasARIdata_R</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">register</span><span class="p">:</span>
            <span class="n">xmlElement</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;ARI&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ARoperationsNode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmlElement</span><span class="p">)</span></div>

<div class="viewcode-block" id="patientData.saveARI"><a class="viewcode-back" href="../index.html#patientData.patientData.saveARI">[docs]</a>    <span class="k">def</span> <span class="nf">saveARI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filePath</span><span class="p">,</span> <span class="n">plotFileFormat</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">plotFileFormat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plotFileFormat</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="s1">&#39;jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;tif&#39;</span><span class="p">,</span> <span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="s1">&#39;eps&#39;</span><span class="p">,</span> <span class="s1">&#39;ps&#39;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;TFA Plot file format </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s1"> not recognized. Exiting...&#39;</span> <span class="o">%</span> <span class="n">plotFileFormat</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasARIdata_L</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasARIdata_R</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No ARI data was found. Canceling save...&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;simple_text&#39;</span><span class="p">:</span>
            <span class="n">outputFile</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">setFileExtension</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s1">&#39;.ari&#39;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasARIdata_L</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasARIdata_R</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ARI_L</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">writeMode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ARI_R</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">writeMode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasARIdata_L</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ARI_L</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">writeMode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasARIdata_R</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ARI_R</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">writeMode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">signals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasARIdata_L</span><span class="p">:</span>
                <span class="n">nPoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_L</span><span class="o">.</span><span class="n">nDuration</span>
                <span class="n">signals</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ARI_L</span><span class="o">.</span><span class="n">timeVals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_L</span><span class="o">.</span><span class="n">stepResponse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_L</span><span class="o">.</span><span class="n">ARIbestFit</span><span class="p">]</span>
                <span class="n">header</span> <span class="o">+=</span> <span class="s1">&#39;time (s);impulse_response_L;best_fit_curve_L;&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasARIdata_R</span><span class="p">:</span>
                <span class="n">nPoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_R</span><span class="o">.</span><span class="n">nDuration</span>
                <span class="c1"># add frequency vector only if there is no left PSD data</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasARIdata_L</span><span class="p">:</span>
                    <span class="n">signals</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ARI_R</span><span class="o">.</span><span class="n">timeVals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_R</span><span class="o">.</span><span class="n">stepResponse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_R</span><span class="o">.</span><span class="n">ARIbestFit</span><span class="p">]</span>
                    <span class="n">header</span> <span class="o">+=</span> <span class="s1">&#39;time (s);impulse_response_R;best_fit_curve_R;&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">signals</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ARI_R</span><span class="o">.</span><span class="n">stepResponse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_R</span><span class="o">.</span><span class="n">ARIbestFit</span><span class="p">]</span>
                    <span class="n">header</span> <span class="o">+=</span> <span class="s1">&#39;impulse_response_R;best_fit_curve_R;&#39;</span>

            <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
                <span class="n">outputFile</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">setFileExtension</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fOut</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasARIdata_L</span><span class="p">:</span>
                        <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ARI_INT_BEST_FIT_L;</span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_L</span><span class="o">.</span><span class="n">ARI_int</span><span class="p">)</span>
                        <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ARI_FRAC_BEST_FIT_L;</span><span class="si">%f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_L</span><span class="o">.</span><span class="n">ARI_frac</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasARIdata_R</span><span class="p">:</span>
                        <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ARI_INT_BEST_FIT_R;</span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_R</span><span class="o">.</span><span class="n">ARI_int</span><span class="p">)</span>
                        <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ARI_FRAC_BEST_FIT_R;</span><span class="si">%f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_R</span><span class="o">.</span><span class="n">ARI_frac</span><span class="p">)</span>
                    <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;N_POINTS;</span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nPoints</span><span class="p">)</span>
                    <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;-------DATA START-------;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">signals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">signals</span><span class="p">))</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fOut</span><span class="p">,</span> <span class="n">signals</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.15e</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;-------DATA END-------;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;numpy&#39;</span><span class="p">:</span>
                <span class="n">outputFile</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">setFileExtension</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s1">&#39;.npy&#39;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>

                <span class="c1"># build a structured array</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasARIdata_L</span><span class="p">:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_L</span><span class="o">.</span><span class="n">ARI_int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_L</span><span class="o">.</span><span class="n">ARI_frac</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_L</span><span class="o">.</span><span class="n">timeVals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_L</span><span class="o">.</span><span class="n">stepResponse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_L</span><span class="o">.</span><span class="n">ARIbestFit</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasARIdata_R</span><span class="p">:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_R</span><span class="o">.</span><span class="n">ARI_int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_L</span><span class="o">.</span><span class="n">ARI_frac</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_R</span><span class="o">.</span><span class="n">timeVals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_R</span><span class="o">.</span><span class="n">stepResponse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARI_R</span><span class="o">.</span><span class="n">ARIbestFit</span><span class="p">))</span>

                <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([(</span><span class="s1">&#39;side&#39;</span><span class="p">,</span> <span class="s1">&#39;U1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ARI_int&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ARI_frac&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;time_(s)&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="n">nPoints</span><span class="p">,)),</span>
                               <span class="p">(</span><span class="s1">&#39;impulse_response&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="n">nPoints</span><span class="p">,)),</span> <span class="p">(</span><span class="s1">&#39;ari_best_fit&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="n">nPoints</span><span class="p">,))])</span>

                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plotFileFormat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasARIdata_L</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ARI_L</span><span class="o">.</span><span class="n">savePlot</span><span class="p">(</span><span class="n">fileNamePrefix</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filePath</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_Left&#39;</span><span class="p">,</span> <span class="n">fileType</span><span class="o">=</span><span class="n">plotFileFormat</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">figDpi</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasARIdata_R</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ARI_R</span><span class="o">.</span><span class="n">savePlot</span><span class="p">(</span><span class="n">fileNamePrefix</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filePath</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_Right&#39;</span><span class="p">,</span> <span class="n">fileType</span><span class="o">=</span><span class="n">plotFileFormat</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">figDpi</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">register</span><span class="p">:</span>
            <span class="n">xmlElement</span> <span class="o">=</span> <span class="n">ETree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;ARIsave&#39;</span><span class="p">)</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;fileName&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filePath</span><span class="p">))</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;plotFileFormat&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">plotFileFormat</span><span class="p">))</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">ETaddElement</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">xmlElement</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ARoperationsNode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmlElement</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ok!&#39;</span><span class="p">)</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Sorry! This program requires Python 3.x</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">patientData</span><span class="o">.</span><span class="n">getVersion</span><span class="p">())</span>

    <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;../data/CG24HG.EXP&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;../data/CG24HG_AR.job&#39;</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">patientData</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">activeModule</span><span class="o">=</span><span class="s1">&#39;ARanalysis&#39;</span><span class="p">)</span>

    <span class="p">[</span><span class="n">medias_G_L</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">TFA_L</span><span class="o">.</span><span class="n">getGainStatistics</span><span class="p">(</span><span class="n">freqRange</span><span class="o">=</span><span class="s1">&#39;LF&#39;</span><span class="p">,</span> <span class="n">coheTreshold</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">listChannels</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">findChannel</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;Analog_2&#39;</span><span class="p">))</span>

    <span class="n">x</span><span class="o">.</span><span class="n">saveSIG</span><span class="p">(</span><span class="s1">&#39;../data/lixo.sig&#39;</span><span class="p">)</span>

    <span class="c1"># for i in range(x.nChannels):</span>
    <span class="c1"># x.signals[i].resample(51,method=&#39;quadratic&#39;)</span>
    <span class="c1"># x.signals[i].setLabel(&#39;signal_%d&#39; % i)</span>
    <span class="c1"># x.signals[i].calibrate(i*10,i*20,method=&#39;percentile&#39;)</span>
    <span class="c1"># x.signals[i].info()</span>
    <span class="c1"># print(x.signals[i].data)</span>
    <span class="c1"># x.signals[i].cropFromRight(0)</span>
    <span class="c1"># x.signals[i].interpolate(2,2)</span>
    <span class="c1"># print(x.signals[i].data)</span>

    <span class="c1"># x.synchronizeSignals([1,2,0,3])</span>

    <span class="c1"># for i in range(x.nChannels):</span>
    <span class="c1">#    print(x.signals[i].data)</span>

    <span class="c1"># x.saveSignals(&#39;lixo.res&#39;)</span>
    <span class="c1"># x.findRRmarks(refChannel=0,method=&#39;md&#39;,findPeaks=True,findValleys=False)</span>

    <span class="c1"># print(x.peakIdx)</span>
    <span class="c1"># x.signals[4].cropInterval(6,12,register=True,RemoveSegment=True,segmentIndexes=peaks)</span>
    <span class="c1"># x.getBeat2beat(resampleRate_Hz=1.0,resampleMethod=&#39;linear&#39;)</span>

    <span class="c1"># for i in range(x.nChannels):</span>
    <span class="c1">#    print(x.signals[i].beat2beatData.max)</span>
    <span class="c1">#    print(x.signals[i].beat2beatData.min)</span>
    <span class="c1">#    print(x.signals[i].beat2beatData.avg)</span>

    <span class="c1"># x.saveOperations()</span>
    <span class="c1"># x.saveBeat2beat(&#39;lixo.b2b&#39;,[0,2])</span>

    <span class="n">x</span><span class="o">.</span><span class="n">saveBeat2beat</span><span class="p">(</span><span class="s1">&#39;../data/lixo.b2b&#39;</span><span class="p">)</span>
    <span class="n">x</span><span class="o">.</span><span class="n">saveSignals</span><span class="p">(</span><span class="s1">&#39;../data/lixo.sig&#39;</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Fernando Moura, Angela Salinet, Joo Salinet Jnior.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>